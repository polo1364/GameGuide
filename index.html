<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="version" content="4.0.1">
    <title>GameMaster ÊîªÁï•Â§ßÂ∏´ | ÈÅäÊà≤ÊîªÁï•ÁîüÊàêÂô®</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4a7c59">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ÊîªÁï•Â§ßÂ∏´">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%234a7c59' width='100' height='100' rx='20'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='white'>üéÆ</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;600;700&family=MedievalSharp&display=swap" rel="stylesheet">
    <style>
        :root {
            --sheikah-blue: #5bcefa;
            --sheikah-glow: #00d4aa;
            --triforce-gold: #d4a430;
            --heart-red: #e85454;
            --ancient-orange: #f5a623;
            --hyrule-green: #4a7c59;
            --bg-parchment: #f4e8d3;
            --bg-dark: #2d2416;
            --bg-card: rgba(244, 232, 211, 0.95);
            --bg-card-dark: rgba(45, 36, 22, 0.9);
            --text-dark: #3d2e1c;
            --text-light: #f4e8d3;
            --border-ancient: rgba(212, 164, 48, 0.5);
            --shadow-sheikah: 0 0 20px rgba(91, 206, 250, 0.3);
            --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.15);
            
            /* Ê∑±Ëâ≤Ê®°ÂºèËÆäÊï∏ */
            --bg-body: linear-gradient(180deg, #87ceeb 0%, #98d4e8 30%, #c5e8d5 60%, #e8f0e0 100%);
            --bg-main: var(--bg-parchment);
            --text-main: var(--text-dark);
        }

        /* Ê∑±Ëâ≤Ê®°Âºè */
        [data-theme="dark"] {
            --bg-parchment: #1a1a2e;
            --bg-dark: #0f0f1a;
            --bg-card: rgba(26, 26, 46, 0.95);
            --bg-card-dark: rgba(15, 15, 26, 0.95);
            --text-dark: #e8e8f0;
            --text-light: #1a1a2e;
            --border-ancient: rgba(212, 164, 48, 0.4);
            --hyrule-green: #6ba37a;
            --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        [data-theme="dark"] body {
            background: linear-gradient(180deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
        }

        [data-theme="dark"] body::before {
            opacity: 0.2;
        }

        [data-theme="dark"] .bg-animation::before {
            background: linear-gradient(180deg, transparent 0%, rgba(91, 206, 250, 0.1) 50%, rgba(91, 206, 250, 0.2) 100%);
        }

        [data-theme="dark"] .bg-animation::after {
            color: var(--sheikah-blue);
            text-shadow: 0 0 20px var(--sheikah-blue);
        }

        [data-theme="dark"] .input-field {
            background: rgba(15, 15, 26, 0.8);
            color: var(--text-dark);
        }

        [data-theme="dark"] .input-field::placeholder {
            color: rgba(232, 232, 240, 0.5);
        }

        [data-theme="dark"] .result-content table {
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.9), rgba(15, 15, 26, 0.9));
        }

        [data-theme="dark"] .result-content thead {
            background: linear-gradient(135deg, var(--sheikah-blue) 0%, #4aa8d8 100%);
        }

        [data-theme="dark"] .result-content tbody tr {
            background: rgba(26, 26, 46, 0.6);
        }

        [data-theme="dark"] .result-content tbody tr:nth-child(even) {
            background: rgba(15, 15, 26, 0.6);
        }

        [data-theme="dark"] .result-content tbody tr:hover {
            background: rgba(91, 206, 250, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(180deg, #87ceeb 0%, #98d4e8 30%, #c5e8d5 60%, #e8f0e0 100%);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 5 L35 25 L55 30 L35 35 L30 55 L25 35 L5 30 L25 25 Z' fill='none' stroke='%23d4a43020' stroke-width='1'/%3E%3C/svg%3E");
            opacity: 0.5;
            pointer-events: none;
            z-index: 0;
        }

        /* Hyrule Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40%;
            background: linear-gradient(180deg, transparent 0%, rgba(74, 124, 89, 0.2) 50%, rgba(74, 124, 89, 0.4) 100%);
        }

        .bg-animation::after {
            content: '‚ñ≤';
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            color: var(--triforce-gold);
            opacity: 0.3;
            text-shadow: 0 0 20px var(--triforce-gold);
            animation: triforceGlow 4s ease-in-out infinite;
        }

        @keyframes triforceGlow {
            0%, 100% { opacity: 0.2; text-shadow: 0 0 20px var(--triforce-gold); }
            50% { opacity: 0.5; text-shadow: 0 0 40px var(--triforce-gold), 0 0 60px var(--triforce-gold); }
        }

        .grid-overlay {
            display: none;
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        header {
            text-align: center;
            padding: 3rem 0 2rem;
            animation: fadeInDown 0.8s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            font-family: 'Cinzel', serif;
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--text-dark);
            letter-spacing: 0.15em;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 0 rgba(255,255,255,0.5);
            position: relative;
        }

        .logo::before {
            content: '‚öîÔ∏è';
            position: absolute;
            left: -50px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
        }

        .logo::after {
            content: 'üõ°Ô∏è';
            position: absolute;
            right: -50px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
        }

        .tagline {
            font-family: 'MedievalSharp', cursive;
            font-size: 1.1rem;
            color: var(--hyrule-green);
            letter-spacing: 0.2em;
        }

        /* Settings Button */
        .settings-btn {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 3px solid var(--triforce-gold);
            color: var(--triforce-gold);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 100;
            box-shadow: var(--shadow-soft);
        }

        .settings-btn:hover {
            background: var(--triforce-gold);
            color: var(--bg-dark);
            transform: rotate(90deg) scale(1.1);
        }

        .settings-btn svg {
            width: 24px;
            height: 24px;
        }

        /* Animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Input Section */
        .input-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 2.5rem;
            margin: 2rem 0;
            border: 3px solid var(--border-ancient);
            animation: fadeInUp 0.8s ease-out 0.4s both;
            box-shadow: var(--shadow-soft);
            position: relative;
        }

        .input-section::before {
            content: '‚óÜ';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-parchment);
            padding: 0 1rem;
            color: var(--triforce-gold);
            font-size: 1rem;
        }

        .input-group {
            margin-bottom: 2rem;
        }

        .input-group:last-of-type {
            margin-bottom: 0;
        }

        .input-label {
            display: block;
            font-family: 'Cinzel', serif;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.8rem;
            letter-spacing: 0.05em;
        }

        .input-field {
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-family: 'Noto Sans TC', sans-serif;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid var(--border-ancient);
            border-radius: 8px;
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--triforce-gold);
            box-shadow: 0 0 15px rgba(212, 164, 48, 0.3);
            background: rgba(255, 255, 255, 0.95);
        }

        .input-field::placeholder {
            color: #8b7355;
        }

        textarea.input-field {
            min-height: 150px;
            resize: vertical;
        }

        /* Generate Button */
        .generate-btn {
            width: 100%;
            padding: 1.2rem 2rem;
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            color: #fff;
            background: linear-gradient(135deg, var(--hyrule-green) 0%, #2d5a3d 100%);
            border: 3px solid var(--triforce-gold);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.4s ease;
            margin-top: 2rem;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-soft);
        }

        .generate-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 164, 48, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .generate-btn:hover::before {
            left: 100%;
        }

        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(74, 124, 89, 0.4);
            background: linear-gradient(135deg, #5a8c6a 0%, var(--hyrule-green) 100%);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .generate-btn.loading {
            pointer-events: none;
        }

        .generate-btn.loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid transparent;
            border-top-color: var(--triforce-gold);
            border-radius: 50%;
            margin-left: 1rem;
            animation: spin 1s linear infinite;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Result Section */
        .result-section {
            margin-top: 3rem;
            animation: fadeInUp 0.6s ease-out;
        }

        .result-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 2.5rem;
            border: 3px solid var(--border-ancient);
            position: relative;
            box-shadow: var(--shadow-soft);
        }

        .result-card::before {
            content: 'üìú';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            background: var(--bg-parchment);
            padding: 0 0.5rem;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-ancient);
        }

        .result-title {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .result-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: #8b7355;
            flex-wrap: wrap;
        }

        .result-badge {
            padding: 0.4rem 1rem;
            background: rgba(212, 164, 48, 0.15);
            border-radius: 20px;
            border: 1px solid var(--border-ancient);
            color: var(--text-dark);
        }

        .result-content {
            line-height: 1.9;
            color: var(--text-dark);
        }

        .result-content h1,
        .result-content h2,
        .result-content h3 {
            font-family: 'Cinzel', serif;
            color: var(--hyrule-green);
            margin: 2rem 0 1rem;
        }

        .result-content h1 { font-size: 1.8rem; }
        .result-content h2 { font-size: 1.4rem; border-bottom: 2px solid var(--border-ancient); padding-bottom: 0.5rem; }
        .result-content h3 { font-size: 1.2rem; }

        .result-content p {
            margin-bottom: 1rem;
        }

        .result-content ul,
        .result-content ol {
            margin: 1rem 0;
            padding-left: 2rem;
        }

        .result-content li {
            margin-bottom: 0.5rem;
        }

        .result-content li::marker {
            color: var(--triforce-gold);
        }

        .result-content code {
            background: rgba(212, 164, 48, 0.15);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            color: #5a4a3a;
        }

        .result-content pre {
            background: rgba(45, 36, 22, 0.9);
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            border: 2px solid var(--border-ancient);
            color: var(--bg-parchment);
        }

        .result-content pre code {
            background: transparent;
            padding: 0;
            color: var(--bg-parchment);
        }

        .result-content blockquote {
            border-left: 4px solid var(--triforce-gold);
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            font-style: italic;
            color: #6a5a4a;
            background: rgba(212, 164, 48, 0.08);
            padding: 1rem 1.5rem;
            border-radius: 0 8px 8px 0;
        }

        .result-content strong {
            color: var(--hyrule-green);
            font-weight: 700;
        }

        /* ÁæéËßÄË°®Ê†ºÊ®£Âºè */
        .result-content table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 2rem 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1), 0 0 0 1px var(--border-ancient);
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(244, 232, 211, 0.9));
        }

        .result-content thead {
            background: linear-gradient(135deg, var(--hyrule-green) 0%, #3a6349 100%);
        }

        .result-content th {
            padding: 1rem 1.2rem;
            text-align: left;
            color: var(--text-light);
            font-family: 'Cinzel', serif;
            font-weight: 600;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            border: none;
            position: relative;
        }

        .result-content th::after {
            content: '';
            position: absolute;
            right: 0;
            top: 25%;
            height: 50%;
            width: 1px;
            background: rgba(255, 255, 255, 0.2);
        }

        .result-content th:last-child::after {
            display: none;
        }

        .result-content td {
            padding: 1rem 1.2rem;
            text-align: left;
            border: none;
            border-bottom: 1px solid rgba(212, 164, 48, 0.2);
            vertical-align: top;
            transition: all 0.2s ease;
        }

        .result-content tbody tr {
            background: rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
        }

        .result-content tbody tr:nth-child(even) {
            background: rgba(244, 232, 211, 0.6);
        }

        .result-content tbody tr:hover {
            background: rgba(212, 164, 48, 0.15);
            transform: scale(1.005);
        }

        .result-content tbody tr:last-child td {
            border-bottom: none;
        }

        .result-content tbody tr:last-child td:first-child {
            border-bottom-left-radius: 12px;
        }

        .result-content tbody tr:last-child td:last-child {
            border-bottom-right-radius: 12px;
        }

        /* Ë°®Ê†ºÁ¨¨‰∏ÄÊ¨ÑÂº∑Ë™ø */
        .result-content td:first-child {
            font-weight: 600;
            color: var(--hyrule-green);
        }

        /* Ë°®Ê†ºÈüøÊáâÂºè */
        @media (max-width: 768px) {
            .result-content table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            .result-content th,
            .result-content td {
                padding: 0.8rem;
                font-size: 0.9rem;
            }
        }

        /* Êï∏ÊìöË°®Ê†ºÁâπÊÆäÊ®£Âºè */
        .result-content table.data-table td:not(:first-child) {
            text-align: center;
        }

        /* Ë°®Ê†ºÂÖßÁöÑÁâπÊÆäÊ®ôË®ò */
        .result-content td code {
            background: rgba(74, 124, 89, 0.15);
            color: var(--hyrule-green);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.85em;
        }

        /* Ë°®Ê†ºÊ®ôÈ°åË£ùÈ£æ */
        .table-wrapper {
            position: relative;
            margin: 2rem 0;
        }

        .table-wrapper::before {
            content: 'üìä';
            position: absolute;
            top: -12px;
            left: 20px;
            font-size: 1.2rem;
            background: var(--bg-parchment);
            padding: 0 0.5rem;
            z-index: 1;
        }

        /* Ë°®Ê†ºÂÖßÁâπÊÆäÂÖÉÁ¥†Ê®£Âºè */
        .table-number {
            font-family: 'Cinzel', serif;
            font-weight: 700;
            color: var(--ancient-orange);
            background: rgba(245, 166, 35, 0.1);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .table-check {
            color: #2ecc71;
            font-size: 1.2em;
        }

        .table-cross {
            color: var(--heart-red);
            font-size: 1.2em;
        }

        .table-stars {
            color: var(--triforce-gold);
            letter-spacing: 2px;
            text-shadow: 0 0 5px rgba(212, 164, 48, 0.5);
        }

        .table-stars-empty {
            color: #ccc;
            letter-spacing: 2px;
        }

        /* Ë≥áË®äÂç°ÁâáÊ®£Âºè */
        .result-content .info-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(244, 232, 211, 0.95));
            border: 2px solid var(--border-ancient);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .result-content .info-card::before {
            content: 'üí°';
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--bg-parchment);
            padding: 0 0.5rem;
        }

        /* Ë≠¶Âëä/ÊèêÁ§∫ÂçÄÂ°ä */
        .result-content .tip-block {
            background: linear-gradient(135deg, rgba(91, 206, 250, 0.1), rgba(0, 212, 170, 0.1));
            border-left: 4px solid var(--sheikah-blue);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .result-content .warning-block {
            background: linear-gradient(135deg, rgba(245, 166, 35, 0.1), rgba(232, 84, 84, 0.1));
            border-left: 4px solid var(--ancient-orange);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        /* Ê≠•È©üÂàóË°®ÁâπÊÆäÊ®£Âºè */
        .result-content ol {
            counter-reset: step-counter;
            list-style: none;
            padding-left: 0;
        }

        .result-content ol > li {
            counter-increment: step-counter;
            position: relative;
            padding-left: 3.5rem;
            margin-bottom: 1.2rem;
            min-height: 2.5rem;
        }

        .result-content ol > li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            width: 2.2rem;
            height: 2.2rem;
            background: linear-gradient(135deg, var(--hyrule-green), #3a6349);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Cinzel', serif;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(74, 124, 89, 0.3);
        }

        /* ÂàÜÈöîÁ∑öÊ®£Âºè */
        .result-content hr {
            border: none;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--border-ancient), transparent);
            margin: 2rem 0;
        }

        /* ÈÄ£ÁµêÊ®£Âºè */
        .result-content a {
            color: var(--sheikah-blue);
            text-decoration: none;
            border-bottom: 1px dashed var(--sheikah-blue);
            transition: all 0.3s ease;
        }

        .result-content a:hover {
            color: var(--sheikah-glow);
            border-bottom-style: solid;
        }

        /* Ê®ôÁ±§/ÂæΩÁ´†Ê®£Âºè */
        .result-content .badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            background: linear-gradient(135deg, var(--hyrule-green), #3a6349);
            color: white;
            border-radius: 12px;
            font-size: 0.8em;
            margin: 0 0.2rem;
        }

        .result-content .badge-gold {
            background: linear-gradient(135deg, var(--triforce-gold), #c49420);
        }

        .result-content .badge-red {
            background: linear-gradient(135deg, var(--heart-red), #c94444);
        }

        .result-content .badge-blue {
            background: linear-gradient(135deg, var(--sheikah-blue), #4ab8e8);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(45, 36, 22, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            border: 3px solid var(--triforce-gold);
            box-shadow: 0 0 40px rgba(212, 164, 48, 0.3);
            transform: scale(0.9) translateY(20px);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-title {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: transparent;
            border: 2px solid var(--border-ancient);
            color: #8b7355;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1.5rem;
        }

        .modal-close:hover {
            background: rgba(232, 84, 84, 0.2);
            border-color: var(--heart-red);
            color: var(--heart-red);
        }

        .api-info {
            background: rgba(212, 164, 48, 0.15);
            border: 2px solid var(--border-ancient);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .api-info a {
            color: var(--hyrule-green);
            text-decoration: none;
            font-weight: 600;
        }

        .api-info a:hover {
            text-decoration: underline;
        }

        .save-btn {
            width: 100%;
            padding: 1rem;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
            background: linear-gradient(135deg, var(--triforce-gold), #b8860b);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1.5rem;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 164, 48, 0.4);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(244, 232, 211, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--triforce-gold);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #b8860b;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 3rem 0;
            color: #6a5a4a;
            font-size: 0.9rem;
        }

        footer a {
            color: var(--hyrule-green);
            text-decoration: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .logo {
                font-size: 2.2rem;
            }

            .tagline {
                font-size: 0.85rem;
                letter-spacing: 0.2em;
            }

            .input-section {
                padding: 1.5rem;
            }

            .result-card {
                padding: 1.5rem;
            }

            .modal {
                padding: 2rem;
            }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-card);
            border: 2px solid var(--triforce-gold);
            border-radius: 8px;
            padding: 1rem 2rem;
            color: var(--text-dark);
            box-shadow: var(--shadow-soft);
            z-index: 2000;
            opacity: 0;
            transition: all 0.4s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .toast.error {
            border-color: var(--heart-red);
            box-shadow: 0 0 20px rgba(232, 84, 84, 0.3);
        }

        /* Typing Effect */
        .typing-cursor {
            display: inline-block;
            width: 3px;
            height: 1.2em;
            background: var(--primary-cyan);
            margin-left: 2px;
            animation: blink 1s infinite;
            vertical-align: text-bottom;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* Copy Button */
        .copy-btn {
            padding: 0.6rem 1.2rem;
            background: rgba(212, 164, 48, 0.1);
            border: 1px solid var(--border-ancient);
            border-radius: 6px;
            color: var(--text-dark);
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .copy-btn:hover {
            background: rgba(212, 164, 48, 0.2);
            border-color: var(--triforce-gold);
        }

        .copy-btn svg {
            width: 16px;
            height: 16px;
        }

        /* Sources Section */
        .sources-section {
            margin-top: 2.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--border-ancient);
        }

        .sources-section h3 {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .sources-list {
            list-style: none;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
        }

        .sources-list li {
            margin: 0;
        }

        .sources-list a {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: rgba(74, 124, 89, 0.1);
            border: 1px solid rgba(74, 124, 89, 0.4);
            border-radius: 6px;
            color: var(--hyrule-green);
            text-decoration: none;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .sources-list a:hover {
            background: rgba(74, 124, 89, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(74, 124, 89, 0.2);
        }

        /* Verified Badge */
        .verified-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.3rem 0.8rem;
            background: rgba(74, 124, 89, 0.15);
            border: 1px solid rgba(74, 124, 89, 0.4);
            border-radius: 20px;
            color: var(--hyrule-green);
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }

        /* Quick Templates */
        .quick-templates {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            margin-top: 0.8rem;
        }

        .quick-template-btn {
            padding: 0.5rem 1rem;
            background: rgba(74, 124, 89, 0.1);
            border: 1px solid rgba(74, 124, 89, 0.4);
            border-radius: 6px;
            color: var(--hyrule-green);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-template-btn:hover {
            background: rgba(74, 124, 89, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(74, 124, 89, 0.2);
        }

        /* Popular Games */
        .popular-games {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            margin-top: 0.8rem;
        }

        /* Ëá™ÂãïÂÅµÊ∏¨Âπ≥Âè∞È°ØÁ§∫ */
        .detected-platform {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            padding: 0.8rem 1.2rem;
            background: linear-gradient(135deg, rgba(91, 206, 250, 0.15), rgba(0, 212, 170, 0.15));
            border: 2px solid var(--sheikah-blue);
            border-radius: 10px;
            animation: platformDetected 0.5s ease;
        }

        @keyframes platformDetected {
            0% { opacity: 0; transform: translateY(-10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .detected-label {
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .detected-value {
            font-weight: 700;
            color: var(--hyrule-green);
            font-size: 1rem;
            padding: 0.3rem 0.8rem;
            background: rgba(74, 124, 89, 0.15);
            border-radius: 6px;
        }

        .popular-game-btn {
            padding: 0.5rem 1rem;
            background: rgba(212, 164, 48, 0.1);
            border: 1px solid var(--border-ancient);
            border-radius: 6px;
            color: var(--text-dark);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .popular-game-btn:hover {
            background: rgba(212, 164, 48, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(212, 164, 48, 0.2);
            border-color: var(--triforce-gold);
        }

        /* Game Autocomplete */
        .autocomplete-wrapper {
            position: relative;
        }

        .autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border: 2px solid var(--triforce-gold);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 50;
            display: none;
            box-shadow: var(--shadow-soft);
        }

        .autocomplete-list.active {
            display: block;
            animation: slideDown 0.2s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .autocomplete-item {
            padding: 0.8rem 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            border-bottom: 1px solid var(--border-ancient);
            transition: all 0.2s ease;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover,
        .autocomplete-item.selected {
            background: rgba(212, 164, 48, 0.15);
        }

        .autocomplete-item .game-icon {
            font-size: 1.3rem;
        }

        .autocomplete-item .game-info {
            flex: 1;
        }

        .autocomplete-item .game-name {
            color: var(--text-dark);
            font-weight: 500;
        }

        .autocomplete-item .game-name .highlight {
            color: var(--hyrule-green);
            font-weight: 700;
        }

        .autocomplete-item .game-platform {
            font-size: 0.75rem;
            color: #8b7355;
            margin-top: 0.2rem;
        }

        .autocomplete-hint {
            padding: 0.6rem 1.2rem;
            font-size: 0.8rem;
            color: #8b7355;
            background: rgba(212, 164, 48, 0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .autocomplete-hint kbd {
            padding: 0.2rem 0.5rem;
            background: rgba(212, 164, 48, 0.2);
            border-radius: 4px;
            font-size: 0.75rem;
            color: var(--text-dark);
        }

        .wiki-badge {
            display: inline-block;
            padding: 0.1rem 0.4rem;
            background: rgba(74, 124, 89, 0.1);
            border: 1px solid rgba(74, 124, 89, 0.3);
            border-radius: 4px;
            font-size: 0.7rem;
            color: var(--hyrule-green);
            margin-left: 0.5rem;
        }

        /* Font Size Controls */
        .font-controls {
            position: fixed;
            top: 1.5rem;
            right: 9rem;
            display: flex;
            gap: 0.5rem;
            z-index: 100;
        }

        .font-btn, .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 2px solid var(--border-ancient);
            color: var(--text-dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .theme-toggle {
            position: fixed;
            top: 1.5rem;
            right: 5rem;
            z-index: 100;
        }

        /* ÊµÆÂãïÊõ∏Á±§Èù¢Êùø */
        .floating-panel {
            position: fixed;
            right: -320px;
            top: 50%;
            transform: translateY(-50%);
            width: 320px;
            max-height: 80vh;
            background: var(--bg-card);
            border: 3px solid var(--border-ancient);
            border-right: none;
            border-radius: 16px 0 0 16px;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.2);
            z-index: 200;
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .floating-panel.open {
            right: 0;
        }

        .floating-panel-toggle {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 60px;
            height: 140px;
            background: linear-gradient(135deg, #e85454, #c74444);
            border: 4px solid #ffd700;
            border-right: none;
            border-radius: 20px 0 0 20px;
            box-shadow: -5px 0 25px rgba(0, 0, 0, 0.5), 0 0 20px rgba(255, 215, 0, 0.5), inset 0 0 20px rgba(255, 255, 255, 0.1);
            cursor: pointer;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: white;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            animation: float-hint 3s ease-in-out infinite;
        }

        @keyframes float-hint {
            0%, 100% { transform: translateY(-50%) translateX(0); }
            50% { transform: translateY(-50%) translateX(-8px); }
        }

        .floating-panel-toggle:hover {
            width: 70px;
            background: linear-gradient(135deg, #ff6b6b, #e85454);
            box-shadow: -8px 0 30px rgba(0, 0, 0, 0.6), 0 0 30px rgba(255, 215, 0, 0.7);
            animation: none;
        }

        .floating-panel-toggle span {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-size: 0.9rem;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .floating-panel-toggle span:first-child {
            font-size: 1.5rem;
            animation: pulse-icon 2s ease-in-out infinite;
        }

        @keyframes pulse-icon {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        .floating-panel.open + .floating-panel-toggle {
            right: 320px;
        }

        .panel-header {
            padding: 1rem 1.2rem;
            background: linear-gradient(135deg, var(--hyrule-green), #3a6349);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .panel-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .panel-close:hover {
            opacity: 1;
        }

        .panel-tabs {
            display: flex;
            border-bottom: 2px solid var(--border-ancient);
        }

        .panel-tab {
            flex: 1;
            padding: 0.8rem;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-dark);
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }

        .panel-tab:hover {
            background: rgba(212, 164, 48, 0.1);
        }

        .panel-tab.active {
            border-bottom-color: var(--triforce-gold);
            background: rgba(212, 164, 48, 0.15);
            font-weight: 600;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        /* Êî∂ËóèÂàóË°® */
        .bookmark-list {
            list-style: none;
        }

        .bookmark-item {
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid var(--border-ancient);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bookmark-item:hover {
            background: rgba(212, 164, 48, 0.15);
            transform: translateX(-3px);
        }

        .bookmark-title {
            font-weight: 600;
            color: var(--hyrule-green);
            margin-bottom: 0.3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bookmark-meta {
            font-size: 0.8rem;
            color: #8b7355;
        }

        .bookmark-delete {
            background: none;
            border: none;
            color: var(--heart-red);
            cursor: pointer;
            padding: 0.2rem;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .bookmark-delete:hover {
            opacity: 1;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #8b7355;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* ÁõÆÈåÑÂ∞éËà™ */
        .toc-list {
            list-style: none;
        }

        .toc-item {
            padding: 0.6rem 0.8rem;
            margin-bottom: 0.3rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toc-item:hover {
            background: rgba(212, 164, 48, 0.15);
        }

        .toc-item.active {
            background: rgba(74, 124, 89, 0.2);
            border-left: 3px solid var(--hyrule-green);
        }

        .toc-item[data-level="2"] {
            padding-left: 1.5rem;
            font-size: 0.9rem;
        }

        .toc-item[data-level="3"] {
            padding-left: 2.5rem;
            font-size: 0.85rem;
            color: #6a5a4a;
        }

        .toc-icon {
            opacity: 0.6;
        }

        /* Êî∂ËóèÊåâÈàï */
        .bookmark-btn {
            background: none;
            border: 2px solid var(--triforce-gold);
            color: var(--triforce-gold);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .bookmark-btn:hover {
            background: var(--triforce-gold);
            color: white;
        }

        .bookmark-btn.bookmarked {
            background: var(--triforce-gold);
            color: white;
        }

        /* ÈÅäÊà≤Ë≥áË®äÂç° */
        .game-info-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(244, 232, 211, 0.9));
            border: 2px solid var(--border-ancient);
            border-radius: 12px;
            padding: 1.2rem;
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .game-info-icon {
            font-size: 3rem;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--hyrule-green), #3a6349);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .game-info-details {
            flex: 1;
        }

        .game-info-name {
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--hyrule-green);
            margin-bottom: 0.5rem;
        }

        .game-info-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .game-info-tag {
            padding: 0.2rem 0.6rem;
            background: rgba(212, 164, 48, 0.15);
            border-radius: 12px;
            font-size: 0.8rem;
            color: var(--text-dark);
        }

        .game-info-tag.platform {
            background: rgba(91, 206, 250, 0.2);
            color: #0070cc;
        }

        .game-info-tag.category {
            background: rgba(74, 124, 89, 0.2);
            color: var(--hyrule-green);
        }

        .font-btn:hover, .theme-btn:hover {
            background: var(--triforce-gold);
            color: #fff;
            border-color: var(--triforce-gold);
        }

        /* Follow-up Section */
        .followup-section {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px dashed var(--border-ancient);
        }

        .followup-container {
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .followup-input {
            flex: 1;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-family: 'Noto Sans TC', sans-serif;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid var(--border-ancient);
            border-radius: 8px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            min-height: 60px;
            resize: vertical;
        }

        .followup-input:focus {
            outline: none;
            border-color: var(--triforce-gold);
            box-shadow: 0 0 15px rgba(212, 164, 48, 0.2);
            background: rgba(255, 255, 255, 0.95);
        }

        .followup-input::placeholder {
            color: #8b7355;
        }

        .followup-btn {
            padding: 1rem 1.5rem;
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            font-weight: 600;
            color: #fff;
            background: linear-gradient(135deg, var(--triforce-gold), #b8860b);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .followup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 164, 48, 0.4);
        }

        .followup-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .followup-label {
            font-family: 'Cinzel', serif;
            font-size: 0.95rem;
            color: var(--text-dark);
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Conversation History */
        .conversation-divider {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 2rem 0;
            color: #8b7355;
            font-size: 0.85rem;
        }

        .conversation-divider::before,
        .conversation-divider::after {
            content: '';
            flex: 1;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--border-ancient), transparent);
        }

        .question-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            background: rgba(212, 164, 48, 0.15);
            border: 1px solid var(--border-ancient);
            border-radius: 6px;
            color: var(--text-dark);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        /* Font size variations */
        .font-small .result-content { font-size: 0.9rem; line-height: 1.7; }
        .font-medium .result-content { font-size: 1rem; line-height: 1.9; }
        .font-large .result-content { font-size: 1.15rem; line-height: 2; }
        .font-xlarge .result-content { font-size: 1.3rem; line-height: 2.1; }

        @media (max-width: 768px) {
            .font-controls {
                top: auto;
                bottom: 1.5rem;
                right: 1rem;
            }

            .theme-toggle {
                top: 1.5rem;
                bottom: auto;
                right: 5rem;
            }

            .followup-container {
                flex-direction: column;
            }

            .followup-btn {
                width: 100%;
            }

            .quick-templates,
            .popular-games {
                justify-content: center;
            }

            .floating-panel {
                width: 100%;
                right: -100%;
                border-radius: 0;
                max-height: 70vh;
                top: auto;
                bottom: 0;
                transform: none;
            }

            .floating-panel.open {
                right: 0;
            }

            .floating-panel-toggle {
                width: 60px;
                height: 60px;
                top: auto;
                bottom: 6rem;
                right: 1rem;
                transform: none;
                border-radius: 50%;
                flex-direction: column;
                border: 4px solid #ffd700;
                padding: 0;
                animation: float-hint-mobile 3s ease-in-out infinite;
            }

            @keyframes float-hint-mobile {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-8px); }
            }

            .floating-panel-toggle span:last-child {
                display: none;
            }

            .floating-panel-toggle span:first-child {
                writing-mode: horizontal-tb;
                font-size: 1.8rem;
            }

            .floating-panel.open + .floating-panel-toggle {
                right: 1rem;
                bottom: calc(70vh + 1rem);
            }

            .game-info-card {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
        }

        /* Ê∑±Ëâ≤Ê®°Âºè‰∏ãÁöÑÊµÆÂãïÈù¢Êùø */
        [data-theme="dark"] .floating-panel {
            background: var(--bg-card);
        }

        [data-theme="dark"] .bookmark-item {
            background: rgba(15, 15, 26, 0.6);
        }

        [data-theme="dark"] .game-info-card {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(15, 15, 26, 0.9));
        }

        /* Update Banner */
        .update-banner {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #4a7c59, #3a6349);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3), 0 0 15px rgba(74, 124, 89, 0.4);
            z-index: 10000;
            animation: slideDown 0.5s ease-out;
            border: 2px solid var(--triforce-gold);
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        .update-btn {
            background: var(--triforce-gold);
            color: #2d2416;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.2s;
        }

        .update-btn:hover {
            background: #ffd700;
            transform: scale(1.05);
        }

        .update-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            opacity: 0.7;
            font-size: 1.2rem;
            padding: 0.2rem;
            margin-left: 0.5rem;
        }

        .update-close:hover {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .update-banner {
                left: 1rem;
                right: 1rem;
                transform: none;
                flex-wrap: wrap;
                justify-content: center;
            }

            @keyframes slideDown {
                from {
                    transform: translateY(-100px);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
        }

        /* PWA Install Banner */
        .pwa-install-banner {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--hyrule-green), #3a6349);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            z-index: 300;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        .pwa-install-text {
            font-size: 0.9rem;
        }

        .pwa-install-btn {
            background: white;
            color: var(--hyrule-green);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .pwa-install-btn:hover {
            transform: scale(1.05);
        }

        .pwa-close-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            opacity: 0.7;
            font-size: 1.2rem;
            padding: 0.2rem;
        }

        .pwa-close-btn:hover {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .pwa-install-banner {
                left: 1rem;
                right: 1rem;
                transform: none;
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Background Animation -->
    <div class="bg-animation">
        <div class="grid-overlay"></div>
    </div>

    <!-- Font Size Controls -->
    <div class="font-controls">
        <button class="font-btn" onclick="changeFontSize(-1)" title="Á∏ÆÂ∞èÂ≠óÈ´î">A-</button>
        <button class="font-btn" onclick="changeFontSize(1)" title="ÊîæÂ§ßÂ≠óÈ´î">A+</button>
    </div>

    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button class="theme-btn" onclick="toggleTheme()" title="ÂàáÊèõÊ∑±Ëâ≤Ê®°Âºè" id="themeBtn">üåô</button>
    </div>

    <!-- Floating Bookmark Panel -->
    <div class="floating-panel" id="floatingPanel">
        <div class="panel-header">
            <span class="panel-title">üìö ÊîªÁï•Â∑•ÂÖ∑ÁÆ±</span>
            <button class="panel-close" onclick="togglePanel()">&times;</button>
        </div>
        <div class="panel-tabs">
            <button class="panel-tab active" onclick="switchTab('bookmarks')" data-tab="bookmarks">
                ‚≠ê Êî∂Ëóè
            </button>
            <button class="panel-tab" onclick="switchTab('toc')" data-tab="toc">
                üìë ÁõÆÈåÑ
            </button>
        </div>
        <div class="panel-content" id="panelContent">
            <!-- Bookmarks Tab -->
            <div class="tab-pane active" id="bookmarksPane">
                <ul class="bookmark-list" id="bookmarkList">
                    <li class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <p>ÈÇÑÊ≤íÊúâÊî∂Ëóè‰ªª‰ΩïÊîªÁï•</p>
                        <p style="font-size: 0.8rem; margin-top: 0.5rem;">ÈªûÊìäÊîªÁï•Ê®ôÈ°åÊóÅÁöÑ ‚≠ê Êî∂Ëóè</p>
                    </li>
                </ul>
            </div>
            <!-- TOC Tab -->
            <div class="tab-pane" id="tocPane" style="display: none;">
                <ul class="toc-list" id="tocList">
                    <li class="empty-state">
                        <div class="empty-state-icon">üìë</div>
                        <p>Â∞öÊú™ÁîüÊàêÊîªÁï•</p>
                        <p style="font-size: 0.8rem; margin-top: 0.5rem;">ÁîüÊàêÊîªÁï•ÂæåÊúÉËá™ÂãïÁî¢ÁîüÁõÆÈåÑ</p>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <button class="floating-panel-toggle" onclick="togglePanel()" id="panelToggle">
        <span>üìö</span>
        <span>Â∑•ÂÖ∑ÁÆ±</span>
    </button>

    <!-- Settings Button -->
    <button class="settings-btn" onclick="openModal()" title="API Ë®≠ÂÆö">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
    </button>

    <div class="container">
        <!-- Header -->
        <header>
            <h1 class="logo">Êµ∑ÊãâÈ≠ØÊîªÁï•Êõ∏</h1>
            <p class="tagline">~ ÂãáËÄÖÁöÑÊô∫ÊÖßÊåáÂçó ~</p>
        </header>

        <!-- Input Section -->
        <section class="input-section">
            <div class="input-group">
                <label class="input-label" for="gameName">ÈÅäÊà≤ÂêçÁ®± <span style="font-size: 0.8rem; color: var(--text-secondary);">ÔºàËº∏ÂÖ•ÈóúÈçµÂ≠óËá™ÂãïÊêúÂ∞ãÔºâ</span></label>
                <div class="autocomplete-wrapper">
                    <input type="text" id="gameName" class="input-field" placeholder="‰æãÂ¶ÇÔºöËñ©ÁàæÈÅî„ÄÅËâæÁàæÁôª„ÄÅFF„ÄÅÈ≠îÁâ©Áçµ‰∫∫..." autocomplete="off">
                    <div class="autocomplete-list" id="autocompleteList">
                        <div class="autocomplete-hint">
                            <span>üí° ‰ΩøÁî® <kbd>‚Üë</kbd> <kbd>‚Üì</kbd> ÈÅ∏ÊìáÔºå<kbd>Enter</kbd> Á¢∫Ë™ç</span>
                        </div>
                    </div>
                </div>
                <div class="popular-games">
                    <span style="color: var(--text-secondary); font-size: 0.85rem; margin-right: 0.5rem;">ÁÜ±ÈñÄÔºö</span>
                    <button class="popular-game-btn" onclick="selectGame('Ëñ©ÁàæÈÅîÂÇ≥Ë™™ ÁéãÂúã‰πãÊ∑ö')">Ëñ©ÁàæÈÅîÂÇ≥Ë™™ ÁéãÂúã‰πãÊ∑ö</button>
                    <button class="popular-game-btn" onclick="selectGame('ËâæÁàæÁôªÊ≥ïÁí∞')">ËâæÁàæÁôªÊ≥ïÁí∞</button>
                    <button class="popular-game-btn" onclick="selectGame('Final Fantasy XVI')">FF16</button>
                    <button class="popular-game-btn" onclick="selectGame('È≠îÁâ©Áçµ‰∫∫ ËçíÈáé')">È≠îÁâ©Áçµ‰∫∫ ËçíÈáé</button>
                    <button class="popular-game-btn" onclick="selectGame('ÂéüÁ•û')">ÂéüÁ•û</button>
                    <button class="popular-game-btn" onclick="selectGame('Ëñ©ÁàæÈÅîÂÇ≥Ë™™ Êõ†Èáé‰πãÊÅØ')">Êõ†Èáé‰πãÊÅØ</button>
                    <button class="popular-game-btn" onclick="selectGame('ÈªëÁ•ûË©±ÔºöÊÇüÁ©∫')">ÈªëÁ•ûË©±ÔºöÊÇüÁ©∫</button>
                    <button class="popular-game-btn" onclick="selectGame('ÊñØÊôÆÊãâÈÅÅ3')">ÊñØÊôÆÊãâÈÅÅ3</button>
                </div>
                <!-- Ëá™ÂãïÂÅµÊ∏¨Âπ≥Âè∞È°ØÁ§∫ -->
                <div class="detected-platform" id="detectedPlatformDisplay" style="display: none;">
                    <span class="detected-label">üéØ ÂÅµÊ∏¨Âà∞ÁöÑÂπ≥Âè∞Ôºö</span>
                    <span class="detected-value" id="detectedPlatformText"></span>
                </div>
            </div>
            <div class="input-group">
                <label class="input-label" for="question">ÊÇ®ÁöÑÂïèÈ°å</label>
                <textarea id="question" class="input-field" placeholder="Ë´ãÊèèËø∞ÊÇ®ÊÉ≥‰∫ÜËß£ÁöÑÊîªÁï•ÂÖßÂÆπÔºå‰æãÂ¶ÇÔºö&#10;‚Ä¢ Â¶Ç‰ΩïÊìäÊïóÊüêÂÄã BossÔºü&#10;‚Ä¢ ÊüêÂÄã‰ªªÂãôÁöÑÂÆåÊï¥ÊµÅÁ®ãÊòØ‰ªÄÈ∫ºÔºü&#10;‚Ä¢ Èö±ËóèÈÅìÂÖ∑Âú®Âì™Ë£°Ôºü&#10;‚Ä¢ ÊúÄ‰Ω≥ËßíËâ≤ÈÖçÁΩÆÂª∫Ë≠∞Ôºü"></textarea>
                <div class="quick-templates">
                    <span style="color: var(--text-secondary); font-size: 0.85rem; margin-right: 0.5rem;">Âø´ÈÄüÂïèÈ°åÔºö</span>
                    <button class="quick-template-btn" onclick="selectTemplate('boss')">üó°Ô∏è Boss ÊîªÁï•</button>
                    <button class="quick-template-btn" onclick="selectTemplate('hidden')">üîç Èö±ËóèË¶ÅÁ¥†</button>
                    <button class="quick-template-btn" onclick="selectTemplate('build')">‚öîÔ∏è ÊúÄÂº∑ÈÖçË£ù</button>
                    <button class="quick-template-btn" onclick="selectTemplate('quest')">üìú ‰ªªÂãôÊµÅÁ®ã</button>
                    <button class="quick-template-btn" onclick="selectTemplate('tips')">üí° Êñ∞ÊâãÊåáÂçó</button>
                    <button class="quick-template-btn" onclick="selectTemplate('ending')">üèÜ ÂÖ®ÁµêÂ±ÄÊîªÁï•</button>
                </div>
            </div>
            <button class="generate-btn" id="generateBtn" onclick="generateGuide()">
                ‚ö° ÁîüÊàêÊîªÁï•
            </button>
        </section>

        <!-- Result Section -->
        <section class="result-section" id="resultSection" style="display: none;">
            <!-- Game Info Card -->
            <div class="game-info-card" id="gameInfoCard" style="display: none;">
                <div class="game-info-icon" id="gameInfoIcon">üéÆ</div>
                <div class="game-info-details">
                    <h4 class="game-info-name" id="gameInfoName">ÈÅäÊà≤ÂêçÁ®±</h4>
                    <div class="game-info-meta">
                        <span class="game-info-tag platform" id="gameInfoPlatform">PC</span>
                        <span class="game-info-tag category" id="gameInfoCategory">Âãï‰ΩúÂÜíÈö™</span>
                    </div>
                </div>
            </div>

            <div class="result-card font-medium" id="resultCard">
                <div class="result-header">
                    <h3 class="result-title" id="resultTitle">ÊîªÁï•ÂÖßÂÆπ</h3>
                    <div class="result-meta">
                        <button class="bookmark-btn" id="bookmarkBtn" onclick="toggleBookmark()">
                            ‚≠ê Êî∂Ëóè
                        </button>
                        <span class="result-badge" id="resultPlatform"></span>
                        <span class="verified-badge" id="verifiedBadge" style="display: none;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                            </svg>
                            Â∑≤ÂèÉËÄÉÁ∂≤Ë∑ØË≥áÊñô
                        </span>
                        <button class="copy-btn" onclick="copyResult()">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                            Ë§áË£Ω
                        </button>
                    </div>
                </div>
                <div class="result-content" id="resultContent"></div>
                
                <!-- Follow-up Section -->
                <div class="followup-section">
                    <div class="followup-label">
                        üí¨ ÈáùÂ∞çÊ≠§ÊîªÁï•ÁπºÁ∫åËøΩÂïè
                    </div>
                    <div class="followup-container">
                        <textarea id="followupInput" class="followup-input" placeholder="‰æãÂ¶ÇÔºöÈÄôÂÄã Boss Êúâ‰ªÄÈ∫ºÂº±ÈªûÔºüÁ¨¨‰∏âÈöéÊÆµË¶ÅÊÄéÈ∫ºË∫≤ÈÅøÔºüÊúâÊ≤íÊúâÊõ¥Á∞°ÂñÆÁöÑÊñπÊ≥ïÔºü"></textarea>
                        <button class="followup-btn" id="followupBtn" onclick="askFollowup()">
                            üîÑ ËøΩÂïè
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <p>‚ú¶ Áî± <strong>Gemini</strong> È≠îÊ≥ïÈ©ÖÂãï ‚ú¶ ÊîªÁï•ÂÖßÂÆπÂÉÖ‰æõÂèÉËÄÉ</p>
        </footer>
    </div>

    <!-- API Key Modal -->
    <div class="modal-overlay" id="apiModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">üîê API Ë®≠ÂÆö</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="api-info">
                üí° Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑ Gemini API Key„ÄÇ<br>
                ÂèØÂú® <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a> ÂÖçË≤ªÂèñÂæó„ÄÇ
            </div>
            <div class="input-group">
                <label class="input-label" for="apiKey">Gemini API Key</label>
                <input type="password" id="apiKey" class="input-field" placeholder="Ëº∏ÂÖ•ÊÇ®ÁöÑ API Key...">
            </div>
            <button class="save-btn" onclick="saveApiKey()">üíæ ÂÑ≤Â≠òË®≠ÂÆö</button>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- PWA Install Banner -->
    <div class="pwa-install-banner" id="pwaInstallBanner" style="display: none;">
        <span>üì±</span>
        <span class="pwa-install-text">ÂÆâË£ùÊîªÁï•Â§ßÂ∏´ AppÔºåÈõ¢Á∑ö‰πüËÉΩÊü•ÁúãÊî∂ËóèÔºÅ</span>
        <button class="pwa-install-btn" onclick="installPWA()">ÂÆâË£ù</button>
        <button class="pwa-close-btn" onclick="dismissPWABanner()">‚úï</button>
    </div>

    <script>
        // ==================== IndexedDB Â∞ÅË£ù ====================
        const DB_NAME = 'GameMasterDB';
        const DB_VERSION = 1;
        let db = null;

        // ÂàùÂßãÂåñ IndexedDB
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => {
                    console.error('IndexedDB ÈñãÂïüÂ§±Êïó:', request.error);
                    reject(request.error);
                };
                
                request.onsuccess = () => {
                    db = request.result;
                    console.log('IndexedDB ÈÄ£Êé•ÊàêÂäü');
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    const database = event.target.result;
                    
                    // Ë®≠ÂÆöÂ≠òÂÑ≤ÔºàAPI Key„ÄÅ‰∏ªÈ°å„ÄÅÂ≠óÈ´îÂ§ßÂ∞èÁ≠âÔºâ
                    if (!database.objectStoreNames.contains('settings')) {
                        database.createObjectStore('settings', { keyPath: 'key' });
                    }
                    
                    // Êõ∏Á±§Â≠òÂÑ≤
                    if (!database.objectStoreNames.contains('bookmarks')) {
                        const bookmarkStore = database.createObjectStore('bookmarks', { keyPath: 'id', autoIncrement: true });
                        bookmarkStore.createIndex('gameName', 'gameName', { unique: false });
                        bookmarkStore.createIndex('timestamp', 'timestamp', { unique: false });
                    }
                    
                    // ÊîªÁï•Ê≠∑Âè≤Â≠òÂÑ≤
                    if (!database.objectStoreNames.contains('history')) {
                        const historyStore = database.createObjectStore('history', { keyPath: 'id', autoIncrement: true });
                        historyStore.createIndex('gameName', 'gameName', { unique: false });
                        historyStore.createIndex('timestamp', 'timestamp', { unique: false });
                    }
                    
                    console.log('IndexedDB ÁµêÊßãÂçáÁ¥öÂÆåÊàê');
                };
            });
        }

        // ÂÑ≤Â≠òË®≠ÂÆö
        async function saveSetting(key, value) {
            if (!db) await initDB();
            return new Promise((resolve, reject) => {
                try {
                    const tx = db.transaction('settings', 'readwrite');
                    const store = tx.objectStore('settings');
                    store.put({ key, value });
                    tx.oncomplete = () => resolve();
                    tx.onerror = () => reject(tx.error);
                } catch (e) {
                    // ÂõûÈÄÄÂà∞ localStorage
                    localStorage.setItem(key, typeof value === 'object' ? JSON.stringify(value) : value);
                    resolve();
                }
            });
        }

        // ËÆÄÂèñË®≠ÂÆö
        async function getSetting(key, defaultValue = null) {
            if (!db) {
                try {
                    await initDB();
                } catch (e) {
                    // ÂõûÈÄÄÂà∞ localStorage
                    const val = localStorage.getItem(key);
                    if (val === null) return defaultValue;
                    try { return JSON.parse(val); } catch { return val; }
                }
            }
            return new Promise((resolve) => {
                try {
                    const tx = db.transaction('settings', 'readonly');
                    const store = tx.objectStore('settings');
                    const request = store.get(key);
                    request.onsuccess = () => {
                        if (request.result) {
                            resolve(request.result.value);
                        } else {
                            // ÂòóË©¶Âæû localStorage ÈÅ∑Áßª
                            const oldVal = localStorage.getItem(key);
                            if (oldVal !== null) {
                                let val;
                                try { val = JSON.parse(oldVal); } catch { val = oldVal; }
                                saveSetting(key, val); // ÈÅ∑ÁßªÂà∞ IndexedDB
                                resolve(val);
                            } else {
                                resolve(defaultValue);
                            }
                        }
                    };
                    request.onerror = () => resolve(defaultValue);
                } catch (e) {
                    resolve(defaultValue);
                }
            });
        }

        // ÂÑ≤Â≠òÊõ∏Á±§
        async function saveBookmark(bookmark) {
            if (!db) await initDB();
            return new Promise((resolve, reject) => {
                try {
                    const tx = db.transaction('bookmarks', 'readwrite');
                    const store = tx.objectStore('bookmarks');
                    // ‰ΩøÁî® put ÂèØ‰ª•Êñ∞Â¢ûÊàñÊõ¥Êñ∞
                    const request = store.put(bookmark);
                    request.onsuccess = () => resolve(request.result);
                    tx.onerror = () => reject(tx.error);
                    tx.oncomplete = () => resolve(bookmark.id);
                } catch (e) {
                    reject(e);
                }
            });
        }

        // Âà™Èô§Êõ∏Á±§
        async function deleteBookmarkDB(id) {
            if (!db) await initDB();
            return new Promise((resolve, reject) => {
                try {
                    const tx = db.transaction('bookmarks', 'readwrite');
                    const store = tx.objectStore('bookmarks');
                    store.delete(id);
                    tx.oncomplete = () => resolve();
                    tx.onerror = () => reject(tx.error);
                } catch (e) {
                    reject(e);
                }
            });
        }

        // Áç≤ÂèñÊâÄÊúâÊõ∏Á±§
        async function getAllBookmarks() {
            let results = [];
            
            // ÂÖàÂòóË©¶Âæû IndexedDB ËÆÄÂèñ
            if (db) {
                try {
                    results = await new Promise((resolve) => {
                        const tx = db.transaction('bookmarks', 'readonly');
                        const store = tx.objectStore('bookmarks');
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result || []);
                        request.onerror = () => resolve([]);
                    });
                } catch (e) {
                    console.warn('Âæû IndexedDB ËÆÄÂèñÊõ∏Á±§Â§±Êïó:', e);
                }
            }
            
            // Â¶ÇÊûú IndexedDB Ê≤íÊúâË≥áÊñôÔºåÂæû localStorage ËÆÄÂèñ
            if (results.length === 0) {
                try {
                    const oldBookmarks = localStorage.getItem('game_bookmarks');
                    if (oldBookmarks) {
                        const parsed = JSON.parse(oldBookmarks);
                        if (Array.isArray(parsed) && parsed.length > 0) {
                            results = parsed;
                            // ÈÅ∑ÁßªÂà∞ IndexedDB
                            if (db) {
                                migrateBookmarksToIndexedDB(parsed);
                            }
                        }
                    }
                } catch (e) {
                    console.warn('Âæû localStorage ËÆÄÂèñÊõ∏Á±§Â§±Êïó:', e);
                }
            }
            
            // ÊåâÊôÇÈñìÊà≥ÊéíÂ∫èÔºàÊúÄÊñ∞ÁöÑÂú®ÂâçÔºâ
            results.sort((a, b) => new Date(b.timestamp || 0) - new Date(a.timestamp || 0));
            return results;
        }

        // ÈÅ∑ÁßªÊõ∏Á±§Âà∞ IndexedDB
        async function migrateBookmarksToIndexedDB(bookmarks) {
            for (const bookmark of bookmarks) {
                try {
                    await saveBookmark(bookmark);
                } catch (e) {}
            }
            console.log('Êõ∏Á±§Â∑≤ÈÅ∑ÁßªÂà∞ IndexedDB');
        }

        // ÂÑ≤Â≠òÊ≠∑Âè≤Ë®òÈåÑ
        async function saveHistory(historyItem) {
            if (!db) await initDB();
            return new Promise((resolve, reject) => {
                try {
                    const tx = db.transaction('history', 'readwrite');
                    const store = tx.objectStore('history');
                    const request = store.add(historyItem);
                    request.onsuccess = () => resolve(request.result);
                    tx.onerror = () => reject(tx.error);
                } catch (e) {
                    reject(e);
                }
            });
        }

        // Áç≤ÂèñÊ≠∑Âè≤Ë®òÈåÑ
        async function getHistory(limit = 50) {
            if (!db) await initDB();
            return new Promise((resolve) => {
                try {
                    const tx = db.transaction('history', 'readonly');
                    const store = tx.objectStore('history');
                    const index = store.index('timestamp');
                    const request = index.openCursor(null, 'prev');
                    const results = [];
                    
                    request.onsuccess = (event) => {
                        const cursor = event.target.result;
                        if (cursor && results.length < limit) {
                            results.push(cursor.value);
                            cursor.continue();
                        } else {
                            resolve(results);
                        }
                    };
                    request.onerror = () => resolve([]);
                } catch (e) {
                    resolve([]);
                }
            });
        }

        // ==================== ÊáâÁî®ÁãÄÊÖã ====================
        // State
        let detectedPlatform = null;
        let detectedPlatformRaw = null;
        let apiKey = '';
        let conversationHistory = [];
        let currentGameName = '';
        let currentPlatform = '';
        let fontSizeLevel = 1; // 0=small, 1=medium, 2=large, 3=xlarge
        const fontSizeClasses = ['font-small', 'font-medium', 'font-large', 'font-xlarge'];
        
        // Bookmark and theme state
        let bookmarks = [];
        let currentTheme = 'light';
        let currentGuideData = null; // ÂÑ≤Â≠òÁï∂ÂâçÊîªÁï•Ë≥áÊñô
        let currentGameInfo = null; // ÂÑ≤Â≠òÁï∂ÂâçÈÅäÊà≤Ë≥áË®ä

        // Platform names mapping
        const platformNames = {
            'switch': 'Nintendo Switch',
            'pc': 'PC',
            'ps5': 'PlayStation 5',
            'ps4': 'PlayStation 4',
            'xbox-series': 'Xbox Series X|S',
            'xbox-one': 'Xbox One',
            '3ds': 'Nintendo 3DS',
            'ios': 'iOS (iPhone/iPad)',
            'android': 'Android',
            'steam-deck': 'Steam Deck',
            'retro': 'Á∂ìÂÖ∏‰∏ªÊ©ü'
        };

        // Game Database for autocomplete (loaded from JSON)
        let gameDatabase = [];
        
        // Load game database from JSON file
        async function loadGameDatabase() {
            try {
                const response = await fetch('games.json');
                if (response.ok) {
                    const data = await response.json();
                    gameDatabase = data.games || [];
                    console.log(`‚úÖ Â∑≤ËºâÂÖ• ${gameDatabase.length} Ê¨æÈÅäÊà≤Ë≥áÊñô`);
                } else {
                    console.warn('ÁÑ°Ê≥ïËºâÂÖ• games.jsonÔºå‰ΩøÁî®ÂÖßÂª∫Ë≥áÊñôÂ∫´');
                    loadFallbackDatabase();
                }
            } catch (error) {
                console.warn('ËºâÂÖ• games.json Â§±ÊïóÔºå‰ΩøÁî®ÂÖßÂª∫Ë≥áÊñôÂ∫´:', error);
                loadFallbackDatabase();
            }
        }
        
        // Fallback database if JSON fails to load
        function loadFallbackDatabase() {
            gameDatabase = [
            // Nintendo Switch
            { name: 'Ëñ©ÁàæÈÅîÂÇ≥Ë™™ ÁéãÂúã‰πãÊ∑ö', alias: ['zelda', 'totk', 'ÁéãÊ∑ö', 'tears of the kingdom'], platform: 'Switch', icon: 'üó°Ô∏è' },
            { name: 'Ëñ©ÁàæÈÅîÂÇ≥Ë™™ Êõ†Èáé‰πãÊÅØ', alias: ['zelda', 'botw', 'Êõ†Èáé', 'breath of the wild'], platform: 'Switch', icon: 'üèπ' },
            { name: 'ÊñØÊôÆÊãâÈÅÅ3', alias: ['splatoon', 'ÊºÜÂΩà', 'Âô¥Âô¥'], platform: 'Switch', icon: 'ü¶ë' },
            { name: 'ÂãïÁâ©Ê£ÆÂèãÊúÉ', alias: ['animal crossing', 'ÂãïÊ£Æ', 'acnh'], platform: 'Switch', icon: 'üèùÔ∏è' },
            { name: 'ÂØ∂ÂèØÂ§¢ Êú±ÔºèÁ¥´', alias: ['pokemon', 'ÂØ∂ÂèØÂ§¢', 'Êú±Á¥´', 'scarlet', 'violet', 'sv'], platform: 'Switch', icon: '‚ö°' },
            { name: 'ÂØ∂ÂèØÂ§¢ Êú±ÔºèÁ¥´ Èõ∂‰πãÁßòÂØ∂', alias: ['pokemon', 'Èõ∂‰πãÁßòÂØ∂', 'dlc', 'Á¢ß‰πãÂÅáÈù¢', 'Ëóç‰πãÂúìÁõ§'], platform: 'Switch', icon: 'üíé' },
            { name: 'ÂØ∂ÂèØÂ§¢ÂÇ≥Ë™™ ÈòøÁàæÂÆôÊñØ', alias: ['pokemon', 'arceus', 'ÈòøÁàæÂÆôÊñØ', 'legends arceus', 'pla'], platform: 'Switch', icon: 'üåü' },
            { name: 'ÂØ∂ÂèØÂ§¢ÂÇ≥Ë™™ Z-A', alias: ['pokemon', 'legends za', 'z-a', 'ÂÇ≥Ë™™za'], platform: 'Switch', icon: '‚ú®' },
            { name: 'ÂØ∂ÂèØÂ§¢ Êô∂Áá¶ÈëΩÁü≥ÔºèÊòé‰∫ÆÁèçÁè†', alias: ['pokemon', 'bdsp', 'ÈëΩÁü≥', 'ÁèçÁè†', 'brilliant diamond', 'shining pearl'], platform: 'Switch', icon: 'üíé' },
            { name: 'ÂØ∂ÂèØÂ§¢ ÂäçÔºèÁõæ', alias: ['pokemon', 'sword', 'shield', 'ÂäçÁõæ', 'swsh'], platform: 'Switch', icon: 'üó°Ô∏è' },
            { name: 'ÂØ∂ÂèØÂ§¢ ÂäçÔºèÁõæ Êì¥ÂÖÖÁ•®', alias: ['pokemon', 'Èéß‰πãÂ≠§Â≥∂', 'ÂÜ†‰πãÈõ™Âéü', 'dlc', 'expansion'], platform: 'Switch', icon: 'üèùÔ∏è' },
            { name: 'ÂØ∂ÂèØÂ§¢ Let\'s GoÔºÅÁöÆÂç°‰∏òÔºè‰ºäÂ∏É', alias: ['pokemon', 'lets go', 'ÁöÆÂç°‰∏ò', '‰ºäÂ∏É', 'lgpe'], platform: 'Switch', icon: '‚ö°' },
            { name: 'New ÂØ∂ÂèØÂ§¢Èö®Ê®ÇÊãç', alias: ['pokemon', 'snap', 'Èö®Ê®ÇÊãç', 'new pokemon snap'], platform: 'Switch', icon: 'üì∏' },
            { name: 'ÂØ∂ÂèØÂ§¢‰∏çÂèØÊÄùË≠∞Ëø∑ÂÆÆ ÊïëÈõ£ÈöäDX', alias: ['pokemon', 'mystery dungeon', '‰∏çÂèØÊÄùË≠∞Ëø∑ÂÆÆ', 'ÊïëÈõ£Èöä'], platform: 'Switch', icon: 'üåÄ' },
            { name: 'ÂØ∂ÂèØÂ§¢Â§ßÈõÜÁµê', alias: ['pokemon', 'unite', 'Â§ßÈõÜÁµê', 'moba'], platform: 'Switch/Mobile', icon: 'üèüÔ∏è' },
            { name: 'ÂØ∂ÂèØÂ§¢Sleep', alias: ['pokemon', 'sleep', 'Áù°Áú†'], platform: 'Mobile', icon: 'üò¥' },
            { name: 'ÂØ∂ÂèØÂ§¢GO', alias: ['pokemon', 'go', 'pogo'], platform: 'Mobile', icon: 'üö∂' },
            { name: 'Pok√©mon HOME', alias: ['pokemon', 'home', 'ÂØ∂ÂèØÂ§¢home'], platform: 'Switch/Mobile', icon: 'üè†' },
            { name: 'ÂØ∂ÂèØÂ§¢ Á©∂Ê•µ‰πãÊó•ÔºèÁ©∂Ê•µ‰πãÊúà', alias: ['pokemon', 'ultra sun', 'ultra moon', 'Á©∂Ê•µÊó•Êúà', 'usum'], platform: '3DS', icon: 'üåô' },
            { name: 'ÂØ∂ÂèØÂ§¢ Â§™ÈôΩÔºèÊúà‰∫Æ', alias: ['pokemon', 'sun', 'moon', 'Êó•Êúà', 'sm'], platform: '3DS', icon: '‚òÄÔ∏è' },
            { name: 'ÂØ∂ÂèØÂ§¢ ÁµÇÊ•µÁ¥ÖÂØ∂Áü≥ÔºèÂßãÊ∫êËóçÂØ∂Áü≥', alias: ['pokemon', 'omega ruby', 'alpha sapphire', 'oras'], platform: '3DS', icon: 'üíé' },
            { name: 'ÂØ∂ÂèØÂ§¢ XÔºèY', alias: ['pokemon', 'xy', 'x y'], platform: '3DS', icon: 'ü¶å' },
            { name: 'ÂØ∂ÂèØÂ§¢ Èªë2ÔºèÁôΩ2', alias: ['pokemon', 'black 2', 'white 2', 'b2w2', 'ÈªëÁôΩ2'], platform: 'DS', icon: '‚ö´' },
            { name: 'ÂØ∂ÂèØÂ§¢ ÈªëÔºèÁôΩ', alias: ['pokemon', 'black', 'white', 'bw', 'ÈªëÁôΩ'], platform: 'DS', icon: '‚ö™' },
            { name: 'ÂØ∂ÂèØÂ§¢ ÂøÉÈáëÔºèÈ≠ÇÈäÄ', alias: ['pokemon', 'heartgold', 'soulsilver', 'hgss', 'ÂøÉÈáëÈ≠ÇÈäÄ'], platform: 'DS', icon: 'üíõ' },
            { name: 'ÂØ∂ÂèØÂ§¢ ÈëΩÁü≥ÔºèÁèçÁè†', alias: ['pokemon', 'diamond', 'pearl', 'dp', 'ÈëΩÁèç'], platform: 'DS', icon: 'üí†' },
            { name: 'ÂØ∂ÂèØÂ§¢ ÁôΩÈáë', alias: ['pokemon', 'platinum', 'ÁôΩÈáë', 'pt'], platform: 'DS', icon: 'üîò' },
            { name: 'ÂØ∂ÂèØÂ§¢ ÁÅ´Á¥ÖÔºèËëâÁ∂†', alias: ['pokemon', 'firered', 'leafgreen', 'frlg', 'ÁÅ´Á¥ÖËëâÁ∂†'], platform: 'GBA', icon: 'üî•' },
            { name: 'ÂØ∂ÂèØÂ§¢ Á¥ÖÂØ∂Áü≥ÔºèËóçÂØ∂Áü≥', alias: ['pokemon', 'ruby', 'sapphire', 'rse', 'Á¥ÖËóçÂØ∂Áü≥'], platform: 'GBA', icon: 'üíé' },
            { name: 'ÂØ∂ÂèØÂ§¢ Á∂†ÂØ∂Áü≥', alias: ['pokemon', 'emerald', 'Á∂†ÂØ∂Áü≥'], platform: 'GBA', icon: 'üíö' },
            { name: 'ÂØ∂ÂèØÂ§¢ ÈáëÔºèÈäÄÔºèÊ∞¥Êô∂', alias: ['pokemon', 'gold', 'silver', 'crystal', 'gsc', 'ÈáëÈäÄÊ∞¥Êô∂'], platform: 'GB/GBC', icon: 'ü•á' },
            { name: 'ÂØ∂ÂèØÂ§¢ Á¥ÖÔºèËóçÔºèÈªÉ', alias: ['pokemon', 'red', 'blue', 'yellow', 'rby', 'Á¥ÖËóçÈªÉ', 'ÁöÆÂç°‰∏òÁâà'], platform: 'GB', icon: 'üî¥' },
            
            // Ê¥õÂÖã‰∫∫Á≥ªÂàó
            { name: 'Ê¥õÂÖã‰∫∫11 ÂëΩÈÅãÁöÑÈΩíËº™', alias: ['rockman', 'mega man', 'megaman', 'Ê¥õÂÖã‰∫∫11', 'rockman 11'], platform: 'Switch/PS4/PC', icon: 'ü§ñ' },
            { name: 'Ê¥õÂÖã‰∫∫X ÈÄ±Âπ¥Á¥ÄÂøµÂêàÈõÜ', alias: ['rockman x', 'mega man x', 'megaman x', 'Ê¥õÂÖã‰∫∫x', 'anniversary collection'], platform: 'Switch/PS4/PC', icon: '‚öîÔ∏è' },
            { name: 'Ê¥õÂÖã‰∫∫X ÈÄ±Âπ¥Á¥ÄÂøµÂêàÈõÜ2', alias: ['rockman x', 'mega man x', 'megaman x', 'Ê¥õÂÖã‰∫∫x', 'collection 2'], platform: 'Switch/PS4/PC', icon: '‚öîÔ∏è' },
            { name: 'Ê¥õÂÖã‰∫∫ Á∂ìÂÖ∏ÂêàÈõÜ', alias: ['rockman', 'mega man', 'megaman', 'Ê¥õÂÖã‰∫∫', 'legacy collection'], platform: 'Switch/PS4/PC', icon: 'üéÆ' },
            { name: 'Ê¥õÂÖã‰∫∫ Á∂ìÂÖ∏ÂêàÈõÜ2', alias: ['rockman', 'mega man', 'megaman', 'Ê¥õÂÖã‰∫∫', 'legacy collection 2'], platform: 'Switch/PS4/PC', icon: 'üéÆ' },
            { name: 'Ê¥õÂÖã‰∫∫Zero/ZX Á∂ìÂÖ∏ÂêàÈõÜ', alias: ['rockman zero', 'mega man zero', 'zx', 'Ê¥õÂÖã‰∫∫zero', 'ÂÇëÊ¥õ'], platform: 'Switch/PS4/PC', icon: 'üî¥' },
            { name: 'Ê¥õÂÖã‰∫∫EXE ÂêàÈõÜ', alias: ['rockman exe', 'mega man battle network', 'Ê¥õÂÖã‰∫∫exe', 'battle network', 'bn'], platform: 'Switch/PS4/PC', icon: 'üíª' },
            { name: 'Ê¥õÂÖã‰∫∫X DiVE', alias: ['rockman x dive', 'mega man x dive', 'Ê¥õÂÖã‰∫∫x dive'], platform: 'Mobile/PC', icon: 'üì±' },
            { name: 'Ê¥õÂÖã‰∫∫11', alias: ['rockman 11', 'mega man 11', 'Ê¥õÂÖã‰∫∫11'], platform: 'Switch/PS4/PC', icon: 'ü§ñ' },
            { name: 'Ê¥õÂÖã‰∫∫10', alias: ['rockman 10', 'mega man 10', 'Ê¥õÂÖã‰∫∫10'], platform: 'PS3/Wii/PC', icon: 'ü§ñ' },
            { name: 'Ê¥õÂÖã‰∫∫9', alias: ['rockman 9', 'mega man 9', 'Ê¥õÂÖã‰∫∫9'], platform: 'PS3/Wii', icon: 'ü§ñ' },
            { name: 'Ê¥õÂÖã‰∫∫X8', alias: ['rockman x8', 'mega man x8', 'Ê¥õÂÖã‰∫∫x8'], platform: 'PS2/PC', icon: '‚öîÔ∏è' },
            { name: 'Ê¥õÂÖã‰∫∫X7', alias: ['rockman x7', 'mega man x7', 'Ê¥õÂÖã‰∫∫x7'], platform: 'PS2/PC', icon: '‚öîÔ∏è' },
            { name: 'Ê¥õÂÖã‰∫∫X6', alias: ['rockman x6', 'mega man x6', 'Ê¥õÂÖã‰∫∫x6'], platform: 'PS1/PC', icon: '‚öîÔ∏è' },
            { name: 'Ê¥õÂÖã‰∫∫X5', alias: ['rockman x5', 'mega man x5', 'Ê¥õÂÖã‰∫∫x5'], platform: 'PS1/PC', icon: '‚öîÔ∏è' },
            { name: 'Ê¥õÂÖã‰∫∫X4', alias: ['rockman x4', 'mega man x4', 'Ê¥õÂÖã‰∫∫x4'], platform: 'PS1/PC', icon: '‚öîÔ∏è' },
            { name: 'Ê¥õÂÖã‰∫∫X3', alias: ['rockman x3', 'mega man x3', 'Ê¥õÂÖã‰∫∫x3'], platform: 'SFC/PS1', icon: '‚öîÔ∏è' },
            { name: 'Ê¥õÂÖã‰∫∫X2', alias: ['rockman x2', 'mega man x2', 'Ê¥õÂÖã‰∫∫x2'], platform: 'SFC', icon: '‚öîÔ∏è' },
            { name: 'Ê¥õÂÖã‰∫∫X', alias: ['rockman x', 'mega man x', 'Ê¥õÂÖã‰∫∫x', 'x1'], platform: 'SFC', icon: '‚öîÔ∏è' },
            { name: 'Ê¥õÂÖã‰∫∫Zero 4', alias: ['rockman zero 4', 'mega man zero 4', 'Ê¥õÂÖã‰∫∫zero4', 'ÂÇëÊ¥õ4'], platform: 'GBA', icon: 'üî¥' },
            { name: 'Ê¥õÂÖã‰∫∫Zero 3', alias: ['rockman zero 3', 'mega man zero 3', 'Ê¥õÂÖã‰∫∫zero3', 'ÂÇëÊ¥õ3'], platform: 'GBA', icon: 'üî¥' },
            { name: 'Ê¥õÂÖã‰∫∫Zero 2', alias: ['rockman zero 2', 'mega man zero 2', 'Ê¥õÂÖã‰∫∫zero2', 'ÂÇëÊ¥õ2'], platform: 'GBA', icon: 'üî¥' },
            { name: 'Ê¥õÂÖã‰∫∫Zero', alias: ['rockman zero', 'mega man zero', 'Ê¥õÂÖã‰∫∫zero', 'ÂÇëÊ¥õ'], platform: 'GBA', icon: 'üî¥' },
            { name: 'Ê¥õÂÖã‰∫∫ZX', alias: ['rockman zx', 'mega man zx', 'Ê¥õÂÖã‰∫∫zx'], platform: 'DS', icon: 'üí†' },
            { name: 'Ê¥õÂÖã‰∫∫ZX Advent', alias: ['rockman zx advent', 'mega man zx advent', 'Ê¥õÂÖã‰∫∫zx advent'], platform: 'DS', icon: 'üí†' },
            { name: 'Ê¥õÂÖã‰∫∫EXE 6', alias: ['rockman exe 6', 'mega man battle network 6', 'Ê¥õÂÖã‰∫∫exe6', 'bn6'], platform: 'GBA', icon: 'üíª' },
            { name: 'Ê¥õÂÖã‰∫∫EXE 5', alias: ['rockman exe 5', 'mega man battle network 5', 'Ê¥õÂÖã‰∫∫exe5', 'bn5'], platform: 'GBA/DS', icon: 'üíª' },
            { name: 'Ê¥õÂÖã‰∫∫EXE 4', alias: ['rockman exe 4', 'mega man battle network 4', 'Ê¥õÂÖã‰∫∫exe4', 'bn4'], platform: 'GBA', icon: 'üíª' },
            { name: 'Ê¥õÂÖã‰∫∫EXE 3', alias: ['rockman exe 3', 'mega man battle network 3', 'Ê¥õÂÖã‰∫∫exe3', 'bn3'], platform: 'GBA', icon: 'üíª' },
            { name: 'Ê¥õÂÖã‰∫∫EXE 2', alias: ['rockman exe 2', 'mega man battle network 2', 'Ê¥õÂÖã‰∫∫exe2', 'bn2'], platform: 'GBA', icon: 'üíª' },
            { name: 'Ê¥õÂÖã‰∫∫EXE', alias: ['rockman exe', 'mega man battle network', 'Ê¥õÂÖã‰∫∫exe', 'bn1'], platform: 'GBA', icon: 'üíª' },
            { name: 'ÊµÅÊòüÊ¥õÂÖã‰∫∫3', alias: ['ryuusei no rockman', 'mega man star force 3', 'ÊµÅÊòüÊ¥õÂÖã‰∫∫3', 'star force 3'], platform: 'DS', icon: '‚≠ê' },
            { name: 'ÊµÅÊòüÊ¥õÂÖã‰∫∫2', alias: ['ryuusei no rockman', 'mega man star force 2', 'ÊµÅÊòüÊ¥õÂÖã‰∫∫2', 'star force 2'], platform: 'DS', icon: '‚≠ê' },
            { name: 'ÊµÅÊòüÊ¥õÂÖã‰∫∫', alias: ['ryuusei no rockman', 'mega man star force', 'ÊµÅÊòüÊ¥õÂÖã‰∫∫', 'star force'], platform: 'DS', icon: '‚≠ê' },
            { name: 'Ê¥õÂÖã‰∫∫ÂÇ≥Â•á', alias: ['rockman dash', 'mega man legends', 'Ê¥õÂÖã‰∫∫dash', 'legends'], platform: 'PS1', icon: 'üåç' },
            { name: 'Ê¥õÂÖã‰∫∫ÂÇ≥Â•á2', alias: ['rockman dash 2', 'mega man legends 2', 'Ê¥õÂÖã‰∫∫dash2', 'legends 2'], platform: 'PS1', icon: 'üåç' },
            
            // ÁÇ∏ÂΩàË∂Ö‰∫∫Á≥ªÂàó
            { name: 'Ë∂ÖÁ¥öÁÇ∏ÂΩàË∂Ö‰∫∫R Online', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'super bomberman r online'], platform: 'Switch/PS4/PC', icon: 'üí£' },
            { name: 'Ë∂ÖÁ¥öÁÇ∏ÂΩàË∂Ö‰∫∫R', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'super bomberman r'], platform: 'Switch/PS4/PC', icon: 'üí£' },
            { name: 'Ë∂ÖÁ¥öÁÇ∏ÂΩàË∂Ö‰∫∫R 2', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'super bomberman r 2', 'r2'], platform: 'Switch/PS5/PC', icon: 'üí£' },
            { name: 'ÁÇ∏ÂΩàË∂Ö‰∫∫ ‰∫ÇÊà∞Â∞çÊ±∫', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'battle royale'], platform: 'Switch/PS4', icon: 'üí•' },
            { name: 'Â∞çÊà∞ÁÇ∏ÂΩàË∂Ö‰∫∫', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'taisen'], platform: 'Arcade', icon: 'üí£' },
            { name: 'ÁÇ∏ÂΩàË∂Ö‰∫∫64', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'bomberman 64'], platform: 'N64', icon: 'üí£' },
            { name: 'ÁÇ∏ÂΩàË∂Ö‰∫∫ ÂÇë‰πôÂ§™ÂÇ≥Ë™™', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'jetters', 'ÂÇë‰πôÂ§™'], platform: 'GC/PS2', icon: 'üöÄ' },
            { name: 'ÁÇ∏ÂΩàË∂Ö‰∫∫ Ëã±ÈõÑ', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'hero', 'Ëã±ÈõÑ'], platform: 'PS2', icon: 'üí£' },
            { name: 'ÁÇ∏ÂΩàË∂Ö‰∫∫ Â§ßÈô∏', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'land', 'Â§ßÈô∏'], platform: 'Wii', icon: 'üåç' },
            { name: 'ÁÇ∏ÂΩàË∂Ö‰∫∫ ÊîªÊìä', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'blast'], platform: 'PS3/360', icon: 'üí•' },
            { name: 'ÁÇ∏ÂΩàË∂Ö‰∫∫ Live', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'live'], platform: 'Xbox360', icon: 'üí£' },
            { name: 'Ë∂ÖÁ¥öÁÇ∏ÂΩàË∂Ö‰∫∫', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'super bomberman'], platform: 'SFC', icon: 'üí£' },
            { name: 'Ë∂ÖÁ¥öÁÇ∏ÂΩàË∂Ö‰∫∫2', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'super bomberman 2'], platform: 'SFC', icon: 'üí£' },
            { name: 'Ë∂ÖÁ¥öÁÇ∏ÂΩàË∂Ö‰∫∫3', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'super bomberman 3'], platform: 'SFC', icon: 'üí£' },
            { name: 'Ë∂ÖÁ¥öÁÇ∏ÂΩàË∂Ö‰∫∫4', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'super bomberman 4'], platform: 'SFC', icon: 'üí£' },
            { name: 'Ë∂ÖÁ¥öÁÇ∏ÂΩàË∂Ö‰∫∫5', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'super bomberman 5'], platform: 'SFC', icon: 'üí£' },
            { name: 'ÁÇ∏ÂΩàË∂Ö‰∫∫ ‰∏ñ‰ª£', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'generation'], platform: 'PS2/PSP', icon: 'üí£' },
            { name: 'ÁÇ∏ÂΩàË∂Ö‰∫∫ ÊîúÂ∏∂Áâà', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'portable'], platform: 'PSP', icon: 'üí£' },
            { name: 'ÁÇ∏ÂΩàË∂Ö‰∫∫ ÊïÖ‰∫ã', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'story'], platform: 'PS1/Saturn', icon: 'üìñ' },
            { name: 'ÁÇ∏ÂΩàË∂Ö‰∫∫ ‰∏ñÁïå', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'world'], platform: 'PC-Engine', icon: 'üåç' },
            { name: 'ÁÇ∏ÂΩàË∂Ö‰∫∫ 94', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'bomberman 94'], platform: 'PC-Engine', icon: 'üí£' },
            { name: 'ÁÇ∏ÂΩàË∂Ö‰∫∫ 93', alias: ['bomberman', 'ÁÇ∏ÂΩà‰∫∫', 'ÁÇ∏ÂΩàË∂Ö‰∫∫', 'bomberman 93'], platform: 'PC-Engine', icon: 'üí£' },
            { name: 'Ë∂ÖÁ¥öÁë™Âà©Ê≠êÂÖÑÂºü È©öÂ•á', alias: ['mario', 'wonder', 'Áë™Âà©Ê≠ê', 'È©öÂ•á'], platform: 'Switch', icon: 'üçÑ' },
            { name: 'Ë∂ÖÁ¥öÁë™Âà©Ê≠ê Â•ßÂæ∑Ë≥Ω', alias: ['mario', 'odyssey', 'Â•ßÂæ∑Ë≥Ω'], platform: 'Switch', icon: 'üé©' },
            { name: 'ÁÅ´ÁÑ∞‰πãÁ¥ãÁ´† Engage', alias: ['fire emblem', 'fe', 'ÁÅ´Á¥ã'], platform: 'Switch', icon: '‚öîÔ∏è' },
            { name: 'Áï∞Â∫¶Á•ûÂäç3', alias: ['xenoblade', 'Áï∞Â∫¶Á•ûÂäç', 'xc3'], platform: 'Switch', icon: 'üîÆ' },
            { name: 'Áë™Âà©Ê≠êË≥ΩËªä8 Ë±™ËèØÁâà', alias: ['mario kart', 'mk8', 'Áë™Ëªä'], platform: 'Switch', icon: 'üèéÔ∏è' },
            { name: '‰ªªÂ§©Â†ÇÊòéÊòüÂ§ß‰∫ÇÈ¨• ÁâπÂà•Áâà', alias: ['smash', 'Â§ß‰∫ÇÈ¨•', 'ssbu'], platform: 'Switch', icon: 'üëä' },
            { name: 'Ëñ©ÁàæÈÅîÂÇ≥Ë™™ ÁπîÂ§¢Â≥∂', alias: ['zelda', 'link awakening', 'ÁπîÂ§¢Â≥∂'], platform: 'Switch', icon: 'üåä' },
            { name: 'Ë∑ØÊòìÂêâÊ¥ãÊ®ì3', alias: ['luigi mansion', 'Ë∑ØÊòìÂêâ', 'Ê¥ãÊ®ì'], platform: 'Switch', icon: 'üëª' },
            { name: 'Êòü‰πãÂç°ÊØî Êé¢Á¥¢ÁôºÁèæ', alias: ['kirby', 'Âç°ÊØî', 'forgotten land'], platform: 'Switch', icon: '‚≠ê' },
            { name: 'ÁöÆÂÖãÊïè4', alias: ['pikmin', 'ÁöÆÂÖãÊïè'], platform: 'Switch', icon: 'üå±' },
            { name: 'Â•áÂπªÁîüÊ¥ªiÔºöËΩâÂúàÂúàÁöÑÈæçÂíåÂÅ∑ÂèñÊôÇÈñìÁöÑÂ∞ëÂ•≥', alias: ['fantasy life', 'Â•áÂπªÁîüÊ¥ª', 'fantasy life i', 'ËΩâÂúàÂúàÁöÑÈæç', 'ÂÅ∑ÂèñÊôÇÈñì'], platform: 'Switch', icon: 'üêâ' },
            { name: 'ÁâßÂ†¥Áâ©Ë™û WelcomeÔºÅÁæéÈ∫ó‰∫∫Áîü', alias: ['harvest moon', 'story of seasons', 'ÁâßÂ†¥Áâ©Ë™û', 'ÁæéÈ∫ó‰∫∫Áîü'], platform: 'Switch', icon: 'üåæ' },
            { name: 'Á¨¶ÊñáÂ∑•Âª†5', alias: ['rune factory', 'Á¨¶ÊñáÂ∑•Âª†', 'rf5'], platform: 'Switch', icon: '‚öîÔ∏è' },
            { name: 'Â§©Á©ó‰πãÂí≤Á®ªÂß¨', alias: ['sakuna', 'Â§©Á©ó', 'Âí≤Á®ªÂß¨', 'rice and ruin'], platform: 'Switch/PS4/PC', icon: 'üåæ' },
            { name: 'ÂìÜÂï¶AÂ§¢ ÁâßÂ†¥Áâ©Ë™û', alias: ['doraemon', 'ÂìÜÂï¶AÂ§¢', 'ÁâßÂ†¥Áâ©Ë™û'], platform: 'Switch', icon: 'ü§ñ' },
            { name: 'ÈõÜÂêàÂï¶ÔºÅÂãïÁâ©Ê£ÆÂèãÊúÉ', alias: ['animal crossing', 'ÂãïÊ£Æ', 'acnh', 'ÈõÜÂêàÂï¶'], platform: 'Switch', icon: 'üèùÔ∏è' },
            { name: 'Rune Factory 4 Special', alias: ['rune factory 4', 'Á¨¶ÊñáÂ∑•Âª†4', 'rf4'], platform: 'Switch', icon: 'üå∏' },
            
            // PlayStation
            { name: 'Final Fantasy XVI', alias: ['ff16', 'ff 16', 'final fantasy', 'ÊúÄÁµÇÂπªÊÉ≥16'], platform: 'PS5', icon: 'üî•' },
            { name: 'Final Fantasy VII ÈáçÁîü', alias: ['ff7', 'rebirth', 'final fantasy 7', 'ÈáçÁîü'], platform: 'PS5', icon: '‚öîÔ∏è' },
            { name: 'Final Fantasy VII ÈáçË£ΩÁâà', alias: ['ff7', 'remake', 'final fantasy 7', 'ÈáçË£Ω'], platform: 'PS5/PS4', icon: 'üåÉ' },
            { name: 'Êà∞Á•û Ë´∏Á•ûÈªÉÊòè', alias: ['god of war', 'ragnarok', 'gow', 'Êà∞Á•û'], platform: 'PS5/PS4', icon: 'ü™ì' },
            { name: 'Âú∞Âπ≥Á∑ö Ë•øÊñπÁ¶ÅÂú∞', alias: ['horizon', 'forbidden west', 'Âú∞Âπ≥Á∑ö'], platform: 'PS5/PS4', icon: 'ü¶ñ' },
            { name: 'Âú∞Âπ≥Á∑ö Èõ∂‰πãÊõôÂÖâ', alias: ['horizon', 'zero dawn', 'Âú∞Âπ≥Á∑ö'], platform: 'PS4/PC', icon: 'üåÖ' },
            { name: 'Êº´Â®ÅËúòËõõ‰∫∫2', alias: ['spider-man', 'spiderman', 'ËúòËõõ‰∫∫'], platform: 'PS5', icon: 'üï∑Ô∏è' },
            { name: 'Êº´Â®ÅËúòËõõ‰∫∫', alias: ['spider-man', 'spiderman', 'ËúòËõõ‰∫∫'], platform: 'PS4/PC', icon: 'üï∏Ô∏è' },
            { name: 'ÊúÄÂæåÁîüÈÇÑËÄÖ Part I', alias: ['last of us', 'tlou', 'ÊúÄÂæåÁîüÈÇÑËÄÖ'], platform: 'PS5/PC', icon: 'üçÑ' },
            { name: 'ÊúÄÂæåÁîüÈÇÑËÄÖ Part II', alias: ['last of us', 'tlou2', 'ÊúÄÂæåÁîüÈÇÑËÄÖ2'], platform: 'PS5/PS4', icon: 'ü¶ã' },
            { name: 'Â∞çÈ¶¨Êà∞È¨º', alias: ['ghost of tsushima', 'got', 'Â∞çÈ¶¨'], platform: 'PS5/PS4/PC', icon: 'üçÉ' },
            { name: 'Ê≠ª‰∫°Êì±Ê∑∫', alias: ['death stranding', 'Ê≠ª‰∫°Êì±Ê∑∫'], platform: 'PS5/PS4/PC', icon: 'üì¶' },
            { name: 'Ë°ÄÊ∫êË©õÂíí', alias: ['bloodborne', 'Ë°ÄÊ∫ê'], platform: 'PS4', icon: 'ü©∏' },
            { name: 'ÊÉ°È≠îÈùàÈ≠Ç', alias: ['demon souls', 'ÊÉ°È≠îÈùàÈ≠Ç'], platform: 'PS5', icon: 'üëπ' },
            { name: 'Stellar Blade', alias: ['stellar blade', 'ÊòüÂàÉ'], platform: 'PS5', icon: '‚ú®' },
            { name: '‰∫∫‰∏≠‰πãÈæç8', alias: ['yakuza', 'like a dragon', '‰∫∫Èæç', 'Â¶ÇÈæç'], platform: 'PS5/PS4', icon: 'üêâ' },
            { name: '‰∫∫‰∏≠‰πãÈæç ÁÑ°ÈôêË≤°ÂØå', alias: ['yakuza', 'like a dragon', '‰∫∫Èæç', 'ÁÑ°ÈôêË≤°ÂØå'], platform: 'PS5', icon: 'üíé' },
            
            // Multi-platform / PC
            { name: 'ËâæÁàæÁôªÊ≥ïÁí∞', alias: ['elden ring', 'er', 'Ê≥ïÁí∞', 'ËÄÅÈ†≠Áí∞'], platform: 'PC/PS5/PS4', icon: 'üíç' },
            { name: 'ËâæÁàæÁôªÊ≥ïÁí∞ ÈªÉÈáëÊ®πÂπΩÂΩ±', alias: ['elden ring', 'shadow of erdtree', 'dlc', 'ÈªÉÈáëÊ®π'], platform: 'PC/PS5/PS4', icon: 'üå≥' },
            { name: 'ÈªëÁ•ûË©±ÔºöÊÇüÁ©∫', alias: ['black myth', 'wukong', 'ÊÇüÁ©∫', 'ÈªëÁ•ûË©±'], platform: 'PC/PS5', icon: 'üêí' },
            { name: 'ÈöªÁãºÔºöÊöóÂΩ±ÈõôÊ≠ª', alias: ['sekiro', 'ÈöªÁãº', 'shadows die twice'], platform: 'PC/PS4', icon: 'ü•∑' },
            { name: 'ÈªëÊöóÈùàÈ≠Ç3', alias: ['dark souls', 'ds3', 'ÈªëÈ≠Ç3'], platform: 'PC/PS4', icon: 'üî•' },
            { name: 'ÈªëÊöóÈùàÈ≠Ç ÈáçË£ΩÁâà', alias: ['dark souls', 'ds1', 'ÈªëÈ≠Ç', 'remastered'], platform: 'PC/PS4/Switch', icon: '‚òÄÔ∏è' },
            { name: 'È≠îÁâ©Áçµ‰∫∫ Â¥õËµ∑', alias: ['monster hunter', 'mh rise', 'È≠îÁâ©', 'Â¥õËµ∑'], platform: 'PC/Switch', icon: 'üê≤' },
            { name: 'È≠îÁâ©Áçµ‰∫∫ Â¥õËµ∑ÔºöÁ†¥Êõâ', alias: ['monster hunter', 'sunbreak', 'Á†¥Êõâ'], platform: 'PC/Switch', icon: 'üåÖ' },
            { name: 'È≠îÁâ©Áçµ‰∫∫ ‰∏ñÁïå', alias: ['monster hunter', 'mhw', '‰∏ñÁïå'], platform: 'PC/PS4', icon: 'üåç' },
            { name: 'È≠îÁâ©Áçµ‰∫∫ ËçíÈáé', alias: ['monster hunter', 'wilds', 'ËçíÈáé', 'mh wilds'], platform: 'PC/PS5', icon: 'üèúÔ∏è' },
            { name: 'ÂéüÁ•û', alias: ['genshin', 'genshin impact', 'ÂéüÁ•û'], platform: 'PC/PS5/PS4/Mobile', icon: '‚≠ê' },
            { name: 'Â¥©Â£ûÔºöÊòüÁ©πÈêµÈÅì', alias: ['honkai', 'star rail', 'ÊòüÈêµ', 'Â¥©Èêµ'], platform: 'PC/PS5/Mobile', icon: 'üöÇ' },
            { name: 'ÁµïÂçÄÈõ∂', alias: ['zenless zone zero', 'zzz', 'ÁµïÂçÄÈõ∂'], platform: 'PC/PS5/Mobile', icon: 'üì∫' },
            { name: 'Â∑´Â∏´3ÔºöÁãÇÁçµ', alias: ['witcher', 'Â∑´Â∏´', 'wild hunt'], platform: 'PC/PS5/PS4/Switch', icon: 'üê∫' },
            { name: 'ÈõªÈ¶≠‰πòÂÆ¢2077', alias: ['cyberpunk', 'ÈõªÈ¶≠', '2077'], platform: 'PC/PS5/PS4', icon: 'üåÜ' },
            { name: 'ÂçöÂæ∑‰πãÈñÄ3', alias: ['baldurs gate', 'bg3', 'ÂçöÂæ∑‰πãÈñÄ'], platform: 'PC/PS5', icon: 'üé≠' },
            { name: 'ËâæÁàæÊñáÊà∞Ë®ò', alias: ['armored core', 'ac6', 'Ê©üÊà∞ÂÇ≠ÂÖµ'], platform: 'PC/PS5/PS4', icon: 'ü§ñ' },
            { name: 'ÊÉ°ÈùàÂè§Â†°4 ÈáçË£ΩÁâà', alias: ['resident evil', 're4', 'ÊÉ°ÈùàÂè§Â†°', 'biohazard'], platform: 'PC/PS5/PS4', icon: 'üßü' },
            { name: 'ÊÉ°ÈùàÂè§Â†° ÊùëËéä', alias: ['resident evil', 'village', 'ÊÉ°ÈùàÂè§Â†°8'], platform: 'PC/PS5/PS4', icon: 'üè∞' },
            { name: 'Ëñ©ÁàæÈÅîÁÑ°Èõô ÁÅΩÂéÑÂïüÁ§∫ÈåÑ', alias: ['hyrule warriors', 'ÁÑ°Èõô', 'ÁÅΩÂéÑ'], platform: 'Switch', icon: '‚öîÔ∏è' },
            { name: 'ÈúçÊ†ºËèØËå≤ÁöÑÂÇ≥Êâø', alias: ['hogwarts', 'legacy', 'ÈúçÊ†ºËèØËå≤', 'ÂìàÂà©Ê≥¢Áâπ'], platform: 'PC/PS5/PS4/Switch', icon: 'üßô' },
            { name: 'Ëá•ÈæçÔºöËíºÂ§©ÈöïËêΩ', alias: ['wo long', 'Ëá•Èæç', 'fallen dynasty'], platform: 'PC/PS5/PS4', icon: 'üêâ' },
            { name: 'Êµ™‰∫∫Â¥õËµ∑', alias: ['rise of ronin', 'Êµ™‰∫∫'], platform: 'PS5', icon: '‚õ©Ô∏è' },
            { name: 'ÁéãÂúã‰πãÂøÉ3', alias: ['kingdom hearts', 'kh3', 'ÁéãÂúã‰πãÂøÉ'], platform: 'PC/PS4', icon: 'üîë' },
            { name: 'Â∞ºÁàæÔºöËá™Âãï‰∫∫ÂΩ¢', alias: ['nier', 'automata', 'Â∞ºÁàæ', 'Ëá™Âãï‰∫∫ÂΩ¢'], platform: 'PC/PS4/Switch', icon: 'ü§ñ' },
            { name: '‰ªÅÁéã2', alias: ['nioh', '‰ªÅÁéã'], platform: 'PC/PS5/PS4', icon: 'üë∫' },
            { name: 'ÊΩõÈæçË´úÂΩ±V ÂπªÁóõ', alias: ['metal gear', 'mgs5', 'ÊΩõÈæç', 'phantom pain'], platform: 'PC/PS4', icon: 'üì¶' },
            { name: 'Âà∫ÂÆ¢ÊïôÊ¢ù ÂπªË±°', alias: ['assassins creed', 'mirage', 'Âà∫ÂÆ¢', 'ÂπªË±°'], platform: 'PC/PS5/PS4', icon: 'üó°Ô∏è' },
            { name: 'Âà∫ÂÆ¢ÊïôÊ¢ù Á∂≠‰∫¨Á¥ÄÂÖÉ', alias: ['assassins creed', 'valhalla', 'Âà∫ÂÆ¢', 'Á∂≠‰∫¨'], platform: 'PC/PS5/PS4', icon: 'ü™ì' },
            { name: 'Á¢ßËóçÂπªÊÉ≥ Relink', alias: ['granblue', 'relink', 'Á¢ßËóçÂπªÊÉ≥'], platform: 'PC/PS5/PS4', icon: '‚ú®' },
            { name: 'Lies of P', alias: ['lies of p', 'ÂåπË´æ‰πî', 'pinocchio'], platform: 'PC/PS5/PS4', icon: 'üé≠' },
            { name: 'ÊöóÈªëÁ†¥Â£ûÁ•û4', alias: ['diablo', 'd4', 'ÊöóÈªë4'], platform: 'PC/PS5/PS4', icon: 'üòà' },
            { name: 'ËñÑÊöÆÂÇ≥Ë™™ Remastered', alias: ['tales of', 'vesperia', 'ËñÑÊöÆÂÇ≥Ë™™'], platform: 'PC/PS4/Switch', icon: '‚≠ê' },
            { name: 'Á†¥ÊõâÂÇ≥Â•á', alias: ['tales of arise', 'Á†¥Êõâ', 'arise'], platform: 'PC/PS5/PS4', icon: 'üå∏' },
            { name: 'ÂÖ´ÊñπÊóÖ‰∫∫2', alias: ['octopath', 'ÂÖ´ÊñπÊóÖ‰∫∫'], platform: 'PC/PS5/PS4/Switch', icon: 'üé≠' },
            ];
        }

        // Question templates
        const questionTemplates = {
            'boss': 'Ë´ãÊèê‰æõË©≥Á¥∞ÁöÑ Boss Êà∞ÊîªÁï•ÔºåÂåÖÊã¨Ôºö\n1. Boss ÁöÑÊîªÊìäÊ®°ÂºèÂíåÊãõÂºè\n2. ÊØèÂÄãÈöéÊÆµÁöÑÊáâÂ∞çÁ≠ñÁï•\n3. Êé®Ëñ¶ÁöÑË£ùÂÇôÂíåÊäÄËÉΩ\n4. ÂÆâÂÖ®ÁöÑËº∏Âá∫ÊôÇÊ©ü\n5. ÈúÄË¶ÅÊ≥®ÊÑèÁöÑËá¥ÂëΩÊîªÊìä',
            'hidden': 'Ë´ãÂàóÂá∫ÈÅäÊà≤‰∏≠ÁöÑÈö±ËóèË¶ÅÁ¥†ÔºåÂåÖÊã¨Ôºö\n1. Èö±ËóèÈÅìÂÖ∑ÂíåÊî∂ÈõÜÂìÅÁöÑ‰ΩçÁΩÆ\n2. Èö±Ëóè‰ªªÂãôÁöÑËß∏ÁôºÊ¢ù‰ª∂\n3. Èö±ËóèÂçÄÂüüÁöÑÈÄ≤ÂÖ•ÊñπÊ≥ï\n4. Èö±ËóèÁµêÂ±ÄÁöÑÈÅîÊàêÊ¢ù‰ª∂',
            'build': 'Ë´ãÊèê‰æõÊúÄÂº∑ËßíËâ≤ÈÖçË£ùÂª∫Ë≠∞ÔºåÂåÖÊã¨Ôºö\n1. Êé®Ëñ¶ÁöÑÊ≠¶Âô®ÂíåÈò≤ÂÖ∑\n2. ÊúÄ‰Ω≥ÊäÄËÉΩÊê≠ÈÖç\n3. Â±¨ÊÄßÈªûÂàÜÈÖçÂª∫Ë≠∞\n4. ‰∏çÂêåÁé©Ê≥ïÈ¢®Ê†ºÁöÑÈÖçË£ùÊñπÊ°à',
            'quest': 'Ë´ãÊèê‰æõÂÆåÊï¥ÁöÑ‰∏ªÁ∑ö/ÊîØÁ∑ö‰ªªÂãôÊîªÁï•ÊµÅÁ®ãÔºåÂåÖÊã¨Ôºö\n1. ‰ªªÂãôÈñãÂßãÊ¢ù‰ª∂\n2. Ë©≥Á¥∞ÁöÑÊ≠•È©üË™™Êòé\n3. ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÈÅ∏ÊìáÂàÜÊîØ\n4. ‰ªªÂãôÁçéÂãµË™™Êòé',
            'tips': 'Ë´ãÊèê‰æõÊñ∞ÊâãÂÖ•ÈñÄÊåáÂçóÔºåÂåÖÊã¨Ôºö\n1. ÈÅäÊà≤Âü∫Êú¨Êìç‰ΩúË™™Êòé\n2. ÂâçÊúüÁôºÂ±ïÂª∫Ë≠∞\n3. ÂÆπÊòìÂøΩÁï•ÁöÑÈáçË¶ÅÊ©üÂà∂\n4. Â∏∏Ë¶ãÊñ∞ÊâãÈåØË™§ÊèêÈÜí\n5. Ë≥áÊ∫êÁç≤ÂèñÊäÄÂ∑ß',
            'ending': 'Ë´ãÊèê‰æõÂÖ®ÁµêÂ±ÄÊîªÁï•ÔºåÂåÖÊã¨Ôºö\n1. ÊâÄÊúâÁµêÂ±ÄÁöÑÈÅîÊàêÊ¢ù‰ª∂\n2. ÂΩ±ÈüøÁµêÂ±ÄÁöÑÈóúÈçµÈÅ∏Êìá\n3. Êé®Ëñ¶ÁöÑÈÅäÁé©È†ÜÂ∫è\n4. ÁúüÁµêÂ±Ä/Èö±ËóèÁµêÂ±ÄÁöÑËß£ÈéñÊñπÊ≥ï'
        };

        // App Version
        const APP_VERSION = '4.0.1';
        
        // Âº∑Âà∂Ê∏ÖÈô§ËàäÂø´Âèñ
        async function clearOldCaches() {
            if ('caches' in window) {
                const cacheNames = await caches.keys();
                for (const name of cacheNames) {
                    if (!name.includes('v5')) {
                        await caches.delete(name);
                        console.log('Â∑≤Âà™Èô§ËàäÂø´Âèñ:', name);
                    }
                }
            }
            // Âº∑Âà∂Êõ¥Êñ∞ Service Worker
            if ('serviceWorker' in navigator) {
                const registrations = await navigator.serviceWorker.getRegistrations();
                for (const reg of registrations) {
                    await reg.update();
                }
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('GameMaster ÁâàÊú¨:', APP_VERSION);
            
            // Ê™¢Êü•‰∏¶Ê∏ÖÈô§ËàäÂø´Âèñ
            const lastVersion = localStorage.getItem('app_version');
            if (lastVersion !== APP_VERSION) {
                console.log('ÁâàÊú¨Êõ¥Êñ∞ÔºåÊ∏ÖÈô§ËàäÂø´Âèñ...');
                await clearOldCaches();
                localStorage.setItem('app_version', APP_VERSION);
            }
            
            // ÂàùÂßãÂåñ IndexedDB
            try {
                await initDB();
                console.log('IndexedDB ÂàùÂßãÂåñÊàêÂäü');
            } catch (e) {
                console.warn('IndexedDB ÂàùÂßãÂåñÂ§±ÊïóÔºå‰ΩøÁî® localStorage ‰ΩúÁÇ∫ÂÇôÊè¥');
            }
            
            // ËºâÂÖ• API Key
            apiKey = await getSetting('gemini_api_key', '');
            if (!apiKey) {
                setTimeout(() => openModal(), 500);
            }
            document.getElementById('apiKey').value = apiKey;
            
            // ËºâÂÖ•Â≠óÈ´îÂ§ßÂ∞èÂÅèÂ•Ω
            const savedFontSize = await getSetting('guide_font_size', 1);
            if (savedFontSize !== null) {
                fontSizeLevel = parseInt(savedFontSize);
                updateFontSize();
            }
            
            // ËºâÂÖ•‰∏ªÈ°åË®≠ÂÆö
            currentTheme = await getSetting('theme', 'light');
            initTheme();
            
            // ËºâÂÖ•Êõ∏Á±§
            bookmarks = await getAllBookmarks();
            renderBookmarks();
            
            // Load game database from JSON
            await loadGameDatabase();
            
            // Initialize autocomplete
            initAutocomplete();
            
            // Register Service Worker for PWA
            registerServiceWorker();
        });
        
        // PWA Service Worker Registration
        let deferredPrompt = null;
        let swRegistration = null;
        
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    swRegistration = await navigator.serviceWorker.register('./sw.js');
                    console.log('ServiceWorker registered:', swRegistration.scope);
                    
                    // ÂÆöÊúüÊ™¢Êü•Êõ¥Êñ∞ÔºàÊØè 30 ÁßíÔºâ
                    setInterval(() => {
                        swRegistration.update();
                    }, 30000);
                    
                    // Check for updates
                    swRegistration.addEventListener('updatefound', () => {
                        const newWorker = swRegistration.installing;
                        console.log('New ServiceWorker found, installing...');
                        
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed') {
                                if (navigator.serviceWorker.controller) {
                                    // New content available
                                    showUpdateBanner();
                                } else {
                                    // First install
                                    console.log('Content cached for offline use');
                                }
                            }
                        });
                    });
                    
                    // Listen for messages from SW
                    navigator.serviceWorker.addEventListener('message', (event) => {
                        if (event.data && event.data.type === 'SW_UPDATED') {
                            console.log('SW updated to version:', event.data.version);
                            showUpdateBanner();
                        }
                    });
                    
                    // È†ÅÈù¢ÂèØË¶ãÊôÇÊ™¢Êü•Êõ¥Êñ∞
                    document.addEventListener('visibilitychange', () => {
                        if (document.visibilityState === 'visible' && swRegistration) {
                            swRegistration.update();
                        }
                    });
                    
                } catch (error) {
                    console.log('ServiceWorker registration failed:', error);
                }
            }
        }
        
        // Êõ¥Êñ∞ÊèêÁ§∫Ê©´ÂπÖ
        function showUpdateBanner() {
            // ÁßªÈô§ËàäÁöÑÊ©´ÂπÖÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
            const existingBanner = document.getElementById('updateBanner');
            if (existingBanner) existingBanner.remove();
            
            const banner = document.createElement('div');
            banner.id = 'updateBanner';
            banner.className = 'update-banner';
            banner.innerHTML = `
                <span>üÜï</span>
                <span>ÁôºÁèæÊñ∞ÁâàÊú¨ÔºÅ</span>
                <button onclick="applyUpdate()" class="update-btn">Á´ãÂç≥Êõ¥Êñ∞</button>
                <button onclick="this.parentElement.remove()" class="update-close">‚úï</button>
            `;
            document.body.appendChild(banner);
        }
        
        // ÊáâÁî®Êõ¥Êñ∞
        function applyUpdate() {
            if (swRegistration && swRegistration.waiting) {
                swRegistration.waiting.postMessage({ type: 'SKIP_WAITING' });
            }
            // Âà∑Êñ∞È†ÅÈù¢
            window.location.reload(true);
        }
        
        // PWA Install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Check if user previously dismissed
            getSetting('pwa_dismissed', false).then(dismissed => {
                if (!dismissed) {
                    setTimeout(() => {
                        document.getElementById('pwaInstallBanner').style.display = 'flex';
                    }, 3000);
                }
            });
        });
        
        function installPWA() {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    showToast('‚úÖ ÊÑüË¨ùÂÆâË£ùÊîªÁï•Â§ßÂ∏´ÔºÅ');
                }
                deferredPrompt = null;
                document.getElementById('pwaInstallBanner').style.display = 'none';
            });
        }
        
        function dismissPWABanner() {
            document.getElementById('pwaInstallBanner').style.display = 'none';
            saveSetting('pwa_dismissed', true);
        }
        
        // Detect if app is installed
        window.addEventListener('appinstalled', () => {
            deferredPrompt = null;
            document.getElementById('pwaInstallBanner').style.display = 'none';
            showToast('‚úÖ App ÂÆâË£ùÊàêÂäüÔºÅ');
        });
        
        // Theme functions
        function initTheme() {
            if (currentTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('themeBtn').textContent = '‚òÄÔ∏è';
            }
        }
        
        function toggleTheme() {
            const btn = document.getElementById('themeBtn');
            if (currentTheme === 'light') {
                currentTheme = 'dark';
                document.documentElement.setAttribute('data-theme', 'dark');
                btn.textContent = '‚òÄÔ∏è';
            } else {
                currentTheme = 'light';
                document.documentElement.removeAttribute('data-theme');
                btn.textContent = 'üåô';
            }
            saveSetting('theme', currentTheme);
        }
        
        // Floating Panel functions
        function togglePanel() {
            const panel = document.getElementById('floatingPanel');
            panel.classList.toggle('open');
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            document.getElementById('bookmarksPane').style.display = tabName === 'bookmarks' ? 'block' : 'none';
            document.getElementById('tocPane').style.display = tabName === 'toc' ? 'block' : 'none';
        }
        
        // Bookmark functions
        async function toggleBookmark() {
            if (!currentGuideData) return;
            
            const existingIndex = bookmarks.findIndex(b => 
                b.gameName === currentGameName && b.question === currentGuideData.question
            );
            
            if (existingIndex >= 0) {
                // Âà™Èô§Êõ∏Á±§
                const bookmarkToDelete = bookmarks[existingIndex];
                if (bookmarkToDelete.id) {
                    try {
                        await deleteBookmarkDB(bookmarkToDelete.id);
                    } catch (e) {
                        console.warn('IndexedDB Âà™Èô§Â§±Êïó:', e);
                    }
                }
                bookmarks.splice(existingIndex, 1);
                document.getElementById('bookmarkBtn').classList.remove('bookmarked');
                document.getElementById('bookmarkBtn').innerHTML = '‚≠ê Êî∂Ëóè';
                showToast('Â∑≤ÂèñÊ∂àÊî∂Ëóè');
            } else {
                // Êñ∞Â¢ûÊõ∏Á±§
                const newBookmark = {
                    id: 'bm_' + Date.now(),
                    gameName: currentGameName,
                    platform: currentPlatform,
                    question: String(currentGuideData.question || ''),
                    content: String(currentGuideData.content || ''),
                    timestamp: new Date().toISOString()
                };
                
                try {
                    await saveBookmark(newBookmark);
                    console.log('Êõ∏Á±§Â∑≤ÂÑ≤Â≠òÂà∞ IndexedDB');
                } catch (e) {
                    console.warn('IndexedDB ÂÑ≤Â≠òÂ§±ÊïóÔºå‰ΩøÁî® localStorage:', e);
                }
                
                bookmarks.unshift(newBookmark);
                document.getElementById('bookmarkBtn').classList.add('bookmarked');
                document.getElementById('bookmarkBtn').innerHTML = '‚≠ê Â∑≤Êî∂Ëóè';
                showToast('Â∑≤Âä†ÂÖ•Êî∂Ëóè');
            }
            
            // ÂêåÊôÇÂÇô‰ªΩÂà∞ localStorage
            syncBookmarksToLocalStorage();
            renderBookmarks();
        }
        
        // ÂêåÊ≠•Êõ∏Á±§Âà∞ localStorageÔºàÂÇôÊè¥Ê©üÂà∂Ôºâ
        function syncBookmarksToLocalStorage() {
            try {
                localStorage.setItem('game_bookmarks', JSON.stringify(bookmarks));
            } catch (e) {
                console.warn('localStorage ÂÑ≤Â≠òÂ§±Êïó:', e);
            }
        }
        
        function renderBookmarks() {
            const list = document.getElementById('bookmarkList');
            
            if (bookmarks.length === 0) {
                list.innerHTML = `
                    <li class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <p>ÈÇÑÊ≤íÊúâÊî∂Ëóè‰ªª‰ΩïÊîªÁï•</p>
                        <p style="font-size: 0.8rem; margin-top: 0.5rem;">ÈªûÊìäÊîªÁï•Ê®ôÈ°åÊóÅÁöÑ ‚≠ê Êî∂Ëóè</p>
                    </li>
                `;
                return;
            }
            
            list.innerHTML = bookmarks.map((bookmark, index) => {
                // Èò≤Ë≠∑ÊÄßÊ™¢Êü• - Á¢∫‰øùÊâÄÊúâÊ¨Ñ‰ΩçÈÉΩÊòØÊ≠£Á¢∫ÁöÑÈ°ûÂûã
                let questionText = '';
                try {
                    if (bookmark && bookmark.question) {
                        questionText = String(bookmark.question);
                    }
                } catch (e) {
                    questionText = '';
                }
                
                const gameName = (bookmark && bookmark.gameName) ? String(bookmark.gameName) : 'Êú™Áü•ÈÅäÊà≤';
                const timestamp = (bookmark && bookmark.timestamp) ? bookmark.timestamp : new Date().toISOString();
                const questionPreview = questionText.length > 30 ? questionText.slice(0, 30) + '...' : questionText;
                
                return `
                    <li class="bookmark-item" onclick="loadBookmark(${index})">
                        <div class="bookmark-title">
                            <span>üéÆ ${gameName}</span>
                            <button class="bookmark-delete" onclick="event.stopPropagation(); deleteBookmark(${index})">‚úï</button>
                        </div>
                        <div class="bookmark-meta">
                            üìù ${questionPreview || 'ÁÑ°ÂïèÈ°åÊèèËø∞'}
                        </div>
                        <div class="bookmark-meta">
                            üìÖ ${new Date(timestamp).toLocaleDateString('zh-TW')}
                        </div>
                    </li>
                `;
            }).join('');
        }
        
        function loadBookmark(index) {
            const bookmark = bookmarks[index];
            if (!bookmark) return;
            
            const gameName = bookmark.gameName || 'Êú™Áü•ÈÅäÊà≤';
            const platform = bookmark.platform || 'Êú™Áü•Âπ≥Âè∞';
            const question = bookmark.question || '';
            const content = bookmark.content || '';
            
            currentGameName = gameName;
            currentPlatform = platform;
            
            document.getElementById('gameName').value = gameName;
            document.getElementById('question').value = typeof question === 'string' ? question : '';
            
            // È°ØÁ§∫ÁµêÊûú
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultTitle').textContent = `${gameName} ÊîªÁï•`;
            document.getElementById('resultPlatform').textContent = platform;
            document.getElementById('resultContent').innerHTML = content;
            
            // Êõ¥Êñ∞Êî∂ËóèÊåâÈàïÁãÄÊÖã
            document.getElementById('bookmarkBtn').classList.add('bookmarked');
            document.getElementById('bookmarkBtn').innerHTML = '‚≠ê Â∑≤Êî∂Ëóè';
            
            currentGuideData = {
                question: question,
                content: content
            };
            
            // ÁîüÊàêÁõÆÈåÑ
            generateTOC();
            
            // ÈóúÈñâÈù¢Êùø
            togglePanel();
            
            // ÊªæÂãïÂà∞ÁµêÊûú
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        async function deleteBookmark(index) {
            const bookmarkToDelete = bookmarks[index];
            if (bookmarkToDelete && bookmarkToDelete.id) {
                try {
                    await deleteBookmarkDB(bookmarkToDelete.id);
                } catch (e) {
                    console.warn('Âæû IndexedDB Âà™Èô§Êõ∏Á±§Â§±Êïó:', e);
                }
            }
            bookmarks.splice(index, 1);
            syncBookmarksToLocalStorage();
            renderBookmarks();
            showToast('Â∑≤Âà™Èô§Êî∂Ëóè');
        }
        
        // TOC (Table of Contents) functions
        function generateTOC() {
            const content = document.getElementById('resultContent');
            const headings = content.querySelectorAll('h1, h2, h3');
            const list = document.getElementById('tocList');
            
            if (headings.length === 0) {
                list.innerHTML = `
                    <li class="empty-state">
                        <div class="empty-state-icon">üìë</div>
                        <p>Ê≠§ÊîªÁï•Ê≤íÊúâÁ´†ÁØÄÊ®ôÈ°å</p>
                    </li>
                `;
                return;
            }
            
            const icons = {
                'H1': 'üìñ',
                'H2': 'üìÑ',
                'H3': 'üìù'
            };
            
            list.innerHTML = headings.length > 0 
                ? Array.from(headings).map((heading, index) => {
                    const level = parseInt(heading.tagName.charAt(1));
                    heading.id = `toc-heading-${index}`;
                    return `
                        <li class="toc-item" data-level="${level}" onclick="scrollToHeading('${heading.id}')">
                            <span class="toc-icon">${icons[heading.tagName] || 'üìù'}</span>
                            <span>${heading.textContent}</span>
                        </li>
                    `;
                }).join('')
                : `
                    <li class="empty-state">
                        <div class="empty-state-icon">üìë</div>
                        <p>Ê≠§ÊîªÁï•Ê≤íÊúâÁ´†ÁØÄÊ®ôÈ°å</p>
                    </li>
                `;
        }
        
        function scrollToHeading(id) {
            const heading = document.getElementById(id);
            if (heading) {
                heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // È´ò‰∫ÆÊïàÊûú
                heading.style.background = 'rgba(212, 164, 48, 0.3)';
                setTimeout(() => {
                    heading.style.background = '';
                }, 2000);
            }
        }
        
        // Update game info card
        function updateGameInfoCard(gameName, platform, category, icon) {
            const card = document.getElementById('gameInfoCard');
            document.getElementById('gameInfoName').textContent = gameName;
            document.getElementById('gameInfoPlatform').textContent = platform;
            document.getElementById('gameInfoCategory').textContent = category || 'ÈÅäÊà≤';
            document.getElementById('gameInfoIcon').textContent = icon || 'üéÆ';
            card.style.display = 'flex';
            currentGameInfo = { gameName, platform, category, icon };
        }

        // Autocomplete state
        let autocompleteSelectedIndex = -1;
        let autocompleteResults = [];
        let searchTimeout = null;
        let isSearching = false;

        // Initialize autocomplete
        function initAutocomplete() {
            const input = document.getElementById('gameName');
            const list = document.getElementById('autocompleteList');

            input.addEventListener('input', (e) => {
                const query = e.target.value.trim();
                
                // Ê∏ÖÈô§‰πãÂâçÂÅµÊ∏¨Âà∞ÁöÑÂπ≥Âè∞ÔºåÁ≠âÁî®Êà∂ÈÅ∏ÊìáÊñ∞ÈÅäÊà≤
                clearDetectedPlatform();
                
                if (query.length < 2) {
                    hideAutocomplete();
                    return;
                }
                
                // Debounce search
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    searchGamesHybrid(query);
                }, 300);
            });

            input.addEventListener('keydown', (e) => {
                if (!list.classList.contains('active')) return;

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    autocompleteSelectedIndex = Math.min(autocompleteSelectedIndex + 1, autocompleteResults.length - 1);
                    updateAutocompleteSelection();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    autocompleteSelectedIndex = Math.max(autocompleteSelectedIndex - 1, 0);
                    updateAutocompleteSelection();
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (autocompleteSelectedIndex >= 0 && autocompleteResults[autocompleteSelectedIndex]) {
                        selectGameFromAutocomplete(autocompleteResults[autocompleteSelectedIndex]);
                    }
                } else if (e.key === 'Escape') {
                    hideAutocomplete();
                }
            });

            input.addEventListener('blur', () => {
                setTimeout(hideAutocomplete, 250);
            });

            input.addEventListener('focus', () => {
                const query = input.value.trim();
                if (query.length >= 2) {
                    searchGamesHybrid(query);
                }
            });
        }

        // Hybrid search: Local database + Wikipedia API
        async function searchGamesHybrid(query) {
            const list = document.getElementById('autocompleteList');
            
            // Show loading state
            list.innerHTML = `
                <div class="autocomplete-hint">
                    <span>üîç ÊêúÂ∞ã‰∏≠...</span>
                </div>
            `;
            list.classList.add('active');
            
            // First, search local database
            const localResults = searchLocalGames(query);
            
            // Then, search Wikipedia
            let wikiResults = [];
            try {
                wikiResults = await searchWikipediaGames(query);
            } catch (error) {
                console.warn('Wikipedia search failed:', error);
            }
            
            // Merge results (local first, then wiki, remove duplicates)
            const seenNames = new Set(localResults.map(g => g.name.toLowerCase()));
            const mergedResults = [...localResults];
            
            for (const wiki of wikiResults) {
                if (!seenNames.has(wiki.name.toLowerCase())) {
                    mergedResults.push(wiki);
                    seenNames.add(wiki.name.toLowerCase());
                }
                if (mergedResults.length >= 10) break;
            }
            
            showAutocomplete(mergedResults, query);
        }

        // Search local game database
        function searchLocalGames(query) {
            const normalizedQuery = query.toLowerCase();
            
            return gameDatabase.filter(game => {
                // Match game name
                if (game.name.toLowerCase().includes(normalizedQuery)) return true;
                
                // Match aliases
                if (game.alias.some(alias => alias.toLowerCase().includes(normalizedQuery))) return true;
                
                // Fuzzy match - check if all characters appear in order
                const chars = normalizedQuery.split('');
                let nameIndex = 0;
                const nameLower = game.name.toLowerCase();
                for (const char of chars) {
                    const foundIndex = nameLower.indexOf(char, nameIndex);
                    if (foundIndex === -1) return false;
                    nameIndex = foundIndex + 1;
                }
                return true;
            }).slice(0, 5);
        }

        // Search Wikipedia for games
        async function searchWikipediaGames(query) {
            const results = [];
            
            // ÂêåÊôÇÊêúÂ∞ã‰∏≠ÊñáÂíåËã±ÊñáÁ∂≠Âü∫ÁôæÁßë
            const searchPromises = [];
            
            // ‰∏≠ÊñáÁ∂≠Âü∫ÁôæÁßë
            searchPromises.push(
                searchWikipedia(query, 'zh').catch(e => {
                    console.warn('Chinese Wikipedia search failed:', e);
                    return [];
                })
            );
            
            // Ëã±ÊñáÁ∂≠Âü∫ÁôæÁßëÔºàÂ¶ÇÊûúÂåÖÂê´Ëã±ÊñáÂ≠óÊØçÊàñÊï∏Â≠óÔºâ
            if (/[a-zA-Z0-9]/.test(query)) {
                searchPromises.push(
                    searchWikipedia(query, 'en').catch(e => {
                        console.warn('English Wikipedia search failed:', e);
                        return [];
                    })
                );
            }
            
            // Êó•ÊñáÁ∂≠Âü∫ÁôæÁßëÔºàÂ¶ÇÊûúÂåÖÂê´Êó•ÊñáÂ≠óÁ¨¶Ôºâ
            if (/[\u3040-\u309F\u30A0-\u30FF]/.test(query)) {
                searchPromises.push(
                    searchWikipedia(query, 'ja').catch(e => {
                        console.warn('Japanese Wikipedia search failed:', e);
                        return [];
                    })
                );
            }
            
            // ‰∏¶Ë°åÊêúÂ∞ãÊâÄÊúâ‰æÜÊ∫ê
            const allResults = await Promise.all(searchPromises);
            
            // Âêà‰ΩµÁµêÊûú‰∏¶ÂéªÈáç
            const seen = new Set();
            for (const resultSet of allResults) {
                for (const result of resultSet) {
                    const key = result.name.toLowerCase().replace(/\s+/g, '');
                    if (!seen.has(key)) {
                        seen.add(key);
                        results.push(result);
                    }
                }
            }
            
            return results.slice(0, 8);
        }

        // Search Wikipedia API - ‰ΩøÁî®Â§öÁ®ÆÁ≠ñÁï•
        async function searchWikipedia(query, lang = 'zh') {
            const results = [];
            
            // Á≠ñÁï•1: Áõ¥Êé•ÊêúÂ∞ãÂéüÂßãÊü•Ë©¢
            try {
                const directResults = await fetchWikipediaSearch(query, lang);
                results.push(...directResults);
            } catch (e) {}
            
            // Á≠ñÁï•2: Âä†‰∏äÈÅäÊà≤ÈóúÈçµÂ≠óÊêúÂ∞ã
            if (results.length < 3) {
                try {
                    const gameQuery = lang === 'zh' ? `${query} ÈÅäÊà≤` : `${query} game`;
                    const gameResults = await fetchWikipediaSearch(gameQuery, lang);
                    results.push(...gameResults);
                } catch (e) {}
            }
            
            // ÂéªÈáç
            const seen = new Set();
            return results.filter(r => {
                if (seen.has(r.name.toLowerCase())) return false;
                seen.add(r.name.toLowerCase());
                return true;
            }).slice(0, 6);
        }

        // Fetch from Wikipedia OpenSearch API
        async function fetchWikipediaSearch(query, lang) {
            const url = `https://${lang}.wikipedia.org/w/api.php?` + new URLSearchParams({
                action: 'opensearch',
                search: query,
                limit: '10',
                namespace: '0',
                format: 'json',
                origin: '*'
            });
            
            const response = await fetch(url);
            if (!response.ok) throw new Error('Wikipedia API error');
            
            const data = await response.json();
            const [searchTerm, titles, descriptions, urls] = data;
            
            // ÈÅäÊà≤Áõ∏ÈóúÈóúÈçµÂ≠óÔºàÊõ¥ÂØ¨È¨ÜÔºâ
            const gameKeywords = [
                'ÈÅäÊà≤', 'Ê∏∏Êàè', 'game', 'video game', 'ÈõªÂ≠êÈÅäÊà≤', 'ÁîµÂ≠êÊ∏∏Êàè',
                'playstation', 'ps4', 'ps5', 'ps3', 'xbox', 'switch', 'nintendo', 
                'pc', 'steam', 'windows', 'rpg', 'action', 'adventure',
                '‰ªªÂ§©Â†Ç', 'square enix', 'capcom', 'konami', 'bandai', 'sega',
                'fromsoft', 'ubisoft', 'ea', 'activision', 'blizzard',
                'ËßíËâ≤ÊâÆÊºî', 'Âãï‰Ωú', 'ÂÜíÈö™', 'Á≠ñÁï•', 'Â∞ÑÊìä', 'Ê†ºÈ¨•', 'Ëß£Ë¨é',
                'dlc', 'ÈáçË£Ω', 'remake', 'remaster', 'edition'
            ];
            
            // ÊéíÈô§ÈóúÈçµÂ≠óÔºàÊõ¥Á≤æÁ¢∫Ôºâ
            const strictExcludeKeywords = [
                'ÈõªÂΩ±', 'ÂãïÁï´', 'Êº´Áï´', 'film', 'movie', 'anime series', 'manga series', 
                'Â∞èË™™', 'novel', 'ÈõªË¶ñÂäá', 'tv series', 'television', 'Ê≠åÊâã', 'singer',
                'ÊºîÂì°', 'actor', 'ÊîøÊ≤ª', 'politician'
            ];
            
            return titles
                .map((title, i) => ({
                    name: cleanGameTitle(title),
                    originalTitle: title,
                    description: descriptions[i] || '',
                    url: urls[i],
                    source: 'wiki',
                    icon: 'üìñ',
                    platform: detectPlatformFromDescription(descriptions[i] || title)
                }))
                .filter((item, i) => {
                    const desc = (descriptions[i] || '').toLowerCase();
                    const title = titles[i].toLowerCase();
                    const combined = desc + ' ' + title;
                    
                    // Ê™¢Êü•ÊòØÂê¶ÊòéÁ¢∫ÊéíÈô§
                    const isStrictlyExcluded = strictExcludeKeywords.some(kw => {
                        if (combined.includes(kw)) {
                            // ‰ΩÜÂ¶ÇÊûúÂêåÊôÇÂåÖÂê´ÈÅäÊà≤ÈóúÈçµÂ≠óÔºåÂâá‰∏çÊéíÈô§
                            const hasGameKeyword = ['ÈÅäÊà≤', 'game', 'video game'].some(gk => combined.includes(gk));
                            return !hasGameKeyword;
                        }
                        return false;
                    });
                    
                    if (isStrictlyExcluded) return false;
                    
                    // ÂØ¨È¨ÜÂà§Êñ∑ÔºöÂè™Ë¶ÅÂåÖÂê´‰ªª‰ΩïÈÅäÊà≤Áõ∏ÈóúÈóúÈçµÂ≠óÂ∞±‰øùÁïô
                    const isLikelyGame = gameKeywords.some(kw => combined.includes(kw));
                    
                    // ÊàñËÄÖÊ®ôÈ°åÊú¨Ë∫´Â∞±ÂÉèÈÅäÊà≤ÂêçÁ®±ÔºàÂåÖÂê´Â∏∏Ë¶ãÈÅäÊà≤ÂêçÁ®±Ê†ºÂºèÔºâ
                    const looksLikeGame = /\d/.test(title) || // ÂåÖÂê´Êï∏Â≠óÔºàÂ¶Ç FF16, ‰ªÅÁéã2Ôºâ
                                          title.includes(':') || // ÂåÖÂê´ÂÜíËôüÔºàÂ¶Ç ÈªëÁ•ûË©±ÔºöÊÇüÁ©∫Ôºâ
                                          title.includes('ÂÇ≥Ë™™') ||
                                          title.includes('Áâ©Ë™û') ||
                                          title.includes('fantasy') ||
                                          title.includes('world') ||
                                          title.includes('saga');
                    
                    return isLikelyGame || looksLikeGame;
                });
        }

        // Clean up Wikipedia title
        function cleanGameTitle(title) {
            // Remove common Wikipedia suffixes
            return title
                .replace(/\s*\(ÈÅäÊà≤\)$/i, '')
                .replace(/\s*\(ÈõªÂ≠êÈÅäÊà≤\)$/i, '')
                .replace(/\s*\(video game\)$/i, '')
                .replace(/\s*\(game\)$/i, '')
                .replace(/\s*\(\d{4}Âπ¥ÈÅäÊà≤\)$/i, '')
                .replace(/\s*\(\d{4} video game\)$/i, '')
                .trim();
        }

        // Detect platform from description
        function detectPlatformFromDescription(desc) {
            const descLower = desc.toLowerCase();
            const platforms = [];
            
            if (descLower.includes('nintendo switch') || descLower.includes('switch')) platforms.push('Switch');
            if (descLower.includes('playstation 5') || descLower.includes('ps5')) platforms.push('PS5');
            if (descLower.includes('playstation 4') || descLower.includes('ps4')) platforms.push('PS4');
            if (descLower.includes('pc') || descLower.includes('windows') || descLower.includes('steam')) platforms.push('PC');
            if (descLower.includes('xbox')) platforms.push('Xbox');
            
            return platforms.length > 0 ? platforms.join('/') : 'Â§öÂπ≥Âè∞';
        }

        // Show autocomplete dropdown
        function showAutocomplete(results, query) {
            const list = document.getElementById('autocompleteList');
            autocompleteResults = results;
            autocompleteSelectedIndex = results.length > 0 ? 0 : -1;

            if (results.length === 0) {
                list.innerHTML = `
                    <div class="autocomplete-hint">
                        <span>üîç Êâæ‰∏çÂà∞Á¨¶ÂêàÁöÑÈÅäÊà≤ÔºåÊÇ®ÂèØ‰ª•Áõ¥Êé•Ëº∏ÂÖ•ÂÆåÊï¥ÂêçÁ®±</span>
                    </div>
                `;
            } else {
                const items = results.map((game, index) => `
                    <div class="autocomplete-item ${index === 0 ? 'selected' : ''}" 
                         data-index="${index}"
                         onclick="selectGameFromAutocomplete(autocompleteResults[${index}])">
                        <span class="game-icon">${game.icon}</span>
                        <div class="game-info">
                            <div class="game-name">${highlightMatch(game.name, query)}</div>
                            <div class="game-platform">
                                ${game.platform}
                                ${game.source === 'wiki' ? '<span class="wiki-badge">Wiki</span>' : ''}
                            </div>
                        </div>
                    </div>
                `).join('');

                list.innerHTML = items + `
                    <div class="autocomplete-hint">
                        <span>üí° ‰ΩøÁî® <kbd>‚Üë</kbd> <kbd>‚Üì</kbd> ÈÅ∏ÊìáÔºå<kbd>Enter</kbd> Á¢∫Ë™çÔΩúË≥áÊñô‰æÜÊ∫êÔºöÊú¨Âú∞Ë≥áÊñôÂ∫´ + Á∂≠Âü∫ÁôæÁßë</span>
                    </div>
                `;
            }

            list.classList.add('active');
        }

        // Highlight matching text
        function highlightMatch(text, query) {
            const lowerText = text.toLowerCase();
            const lowerQuery = query.toLowerCase();
            const index = lowerText.indexOf(lowerQuery);
            
            if (index >= 0) {
                return escapeHtml(text.substring(0, index)) + 
                       '<span class="highlight">' + escapeHtml(text.substring(index, index + query.length)) + '</span>' +
                       escapeHtml(text.substring(index + query.length));
            }
            return escapeHtml(text);
        }

        // Update selection highlight
        function updateAutocompleteSelection() {
            const items = document.querySelectorAll('.autocomplete-item');
            items.forEach((item, index) => {
                item.classList.toggle('selected', index === autocompleteSelectedIndex);
            });
            
            // Scroll into view
            if (items[autocompleteSelectedIndex]) {
                items[autocompleteSelectedIndex].scrollIntoView({ block: 'nearest' });
            }
        }

        // Select game from autocomplete
        function selectGameFromAutocomplete(game) {
            document.getElementById('gameName').value = game.name;
            hideAutocomplete();
            
            const sourceLabel = game.source === 'wiki' ? 'Á∂≠Âü∫ÁôæÁßë' : 'Êú¨Âú∞Ë≥áÊñôÂ∫´';
            showToast(`‚úÖ Â∑≤ÈÅ∏ÊìáÔºö${game.name}`);
            
            // Ëá™ÂãïÂÅµÊ∏¨‰∏¶Ë®≠ÂÆöÂπ≥Âè∞
            if (game.platform) {
                autoDetectPlatform(game.platform);
            } else {
                clearDetectedPlatform();
            }
        }

        // Ëá™ÂãïÂÅµÊ∏¨Âπ≥Âè∞Ôºà‰∏çÈúÄË¶ÅÊâãÂãïÈÅ∏ÊìáÔºâ
        function autoDetectPlatform(platformStr) {
            if (!platformStr) {
                clearDetectedPlatform();
                return;
            }
            
            const platforms = platformStr.toLowerCase();
            let targetPlatform = null;
            let displayName = platformStr; // È†êË®≠È°ØÁ§∫ÂéüÂßãÂ≠ó‰∏≤
            
            // ÂÑ™ÂÖàÈ†ÜÂ∫èÔºöÂæûÊñ∞Âà∞ËàäÔºåÂæû‰∏ªÊµÅÂà∞Ê¨°Ë¶Å
            if (platforms.includes('switch')) {
                targetPlatform = 'switch';
                displayName = 'üéÆ Nintendo Switch';
            } else if (platforms.includes('ps5')) {
                targetPlatform = 'ps5';
                displayName = 'üéÆ PlayStation 5';
            } else if (platforms.includes('xbox series') || platforms.includes('xsx')) {
                targetPlatform = 'xbox-series';
                displayName = 'üü© Xbox Series X|S';
            } else if (platforms.includes('ps4')) {
                targetPlatform = 'ps4';
                displayName = 'üéØ PlayStation 4';
            } else if (platforms.includes('xbox one')) {
                targetPlatform = 'xbox-one';
                displayName = 'üü¢ Xbox One';
            } else if (platforms.includes('pc') || platforms.includes('steam') || platforms.includes('windows')) {
                targetPlatform = 'pc';
                displayName = 'üñ•Ô∏è PC';
            } else if (platforms.includes('steam deck')) {
                targetPlatform = 'steam-deck';
                displayName = 'üé≤ Steam Deck';
            } else if (platforms.includes('ios') || platforms.includes('iphone') || platforms.includes('ipad')) {
                targetPlatform = 'ios';
                displayName = 'üçé iOS';
            } else if (platforms.includes('android')) {
                targetPlatform = 'android';
                displayName = 'ü§ñ Android';
            } else if (platforms.includes('mobile')) {
                targetPlatform = 'mobile';
                displayName = 'üì± Mobile (iOS/Android)';
            } else if (platforms.includes('3ds') || platforms.includes('ds')) {
                targetPlatform = '3ds';
                displayName = 'üì± Nintendo 3DS';
            } else if (platforms.includes('gba') || platforms.includes('sfc') || platforms.includes('ps1') || 
                       platforms.includes('ps2') || platforms.includes('gb') || platforms.includes('n64') ||
                       platforms.includes('wii') || platforms.includes('gamecube') || platforms.includes('gc')) {
                targetPlatform = 'retro';
                displayName = 'üëæ Á∂ìÂÖ∏‰∏ªÊ©ü';
            }
            
            // ÂÑ≤Â≠òÂÅµÊ∏¨ÁµêÊûú
            detectedPlatform = targetPlatform || 'multi';
            detectedPlatformRaw = platformStr;
            
            // Êõ¥Êñ∞UIÈ°ØÁ§∫
            const displayEl = document.getElementById('detectedPlatformDisplay');
            const textEl = document.getElementById('detectedPlatformText');
            
            if (displayEl && textEl) {
                // Â¶ÇÊûúÊòØÂ§öÂπ≥Âè∞ÔºåÈ°ØÁ§∫ÊâÄÊúâÂπ≥Âè∞
                if (platformStr.includes('/') || platformStr.includes(',')) {
                    textEl.textContent = platformStr;
                } else {
                    textEl.textContent = displayName;
                }
                displayEl.style.display = 'flex';
            }
        }
        
        // Ê∏ÖÈô§ÂÅµÊ∏¨ÁöÑÂπ≥Âè∞
        function clearDetectedPlatform() {
            detectedPlatform = null;
            detectedPlatformRaw = null;
            const displayEl = document.getElementById('detectedPlatformDisplay');
            if (displayEl) {
                displayEl.style.display = 'none';
            }
        }

        // Hide autocomplete
        function hideAutocomplete() {
            document.getElementById('autocompleteList').classList.remove('active');
            autocompleteSelectedIndex = -1;
        }

        // Select popular game (Ëá™ÂãïÂÅµÊ∏¨Âπ≥Âè∞)
        function selectGame(gameName) {
            document.getElementById('gameName').value = gameName;
            hideAutocomplete();
            showToast(`‚úÖ Â∑≤ÈÅ∏ÊìáÔºö${gameName}`);
            
            // ÂæûË≥áÊñôÂ∫´‰∏≠Êü•ÊâæÈÅäÊà≤‰∏¶Ëá™ÂãïÂÅµÊ∏¨Âπ≥Âè∞
            const game = gameDatabase.find(g => g.name === gameName);
            if (game && game.platform) {
                autoDetectPlatform(game.platform);
            } else {
                // Â¶ÇÊûúÊâæ‰∏çÂà∞ÔºåÊ†πÊìöÈÅäÊà≤ÂêçÁ®±Êô∫ËÉΩÂà§Êñ∑
                detectPlatformByGameName(gameName);
            }
        }
        
        // Ê†πÊìöÈÅäÊà≤ÂêçÁ®±Êô∫ËÉΩÂà§Êñ∑Âπ≥Âè∞
        function detectPlatformByGameName(gameName) {
            const lowerName = gameName.toLowerCase();
            
            // ‰ªªÂ§©Â†ÇÁç®‰Ωî
            if (lowerName.includes('Ëñ©ÁàæÈÅî') || lowerName.includes('zelda') ||
                lowerName.includes('Áë™Âà©Ê≠ê') || lowerName.includes('mario') ||
                lowerName.includes('ÂØ∂ÂèØÂ§¢') || lowerName.includes('pokemon') ||
                lowerName.includes('ÊñØÊôÆÊãâÈÅÅ') || lowerName.includes('splatoon') ||
                lowerName.includes('ÂãïÁâ©Ê£ÆÂèãÊúÉ') || lowerName.includes('animal crossing') ||
                lowerName.includes('ÁÅ´ÁÑ∞‰πãÁ¥ãÁ´†') || lowerName.includes('fire emblem') ||
                lowerName.includes('Áï∞Â∫¶Á•ûÂäç') || lowerName.includes('xenoblade')) {
                autoDetectPlatform('Switch');
            }
            // PlayStation Áç®‰Ωî
            else if (lowerName.includes('Êà∞Á•û') || lowerName.includes('god of war') ||
                     lowerName.includes('ÊúÄÂæåÁîüÈÇÑËÄÖ') || lowerName.includes('last of us') ||
                     lowerName.includes('ËúòËõõ‰∫∫') || lowerName.includes('spider-man') ||
                     lowerName.includes('Â∞çÈ¶¨') || lowerName.includes('tsushima') ||
                     lowerName.includes('Âú∞Âπ≥Á∑ö') || lowerName.includes('horizon')) {
                autoDetectPlatform('PS5/PS4');
            }
            // ÊâãÊ©üÈÅäÊà≤Â∏∏Ë¶ã
            else if (lowerName.includes('ÂéüÁ•û') || lowerName.includes('genshin') ||
                     lowerName.includes('Â¥©Â£û') || lowerName.includes('honkai') ||
                     lowerName.includes('ÊòéÊó•ÊñπËàü') || lowerName.includes('arknights') ||
                     lowerName.includes('Á•ûÈ≠î‰πãÂ°î') ||
                     lowerName.includes('ÂØ∂ÂèØÂ§¢go') || lowerName.includes('pokemon go')) {
                autoDetectPlatform('iOS/Android');
            }
            // Ë∑®Âπ≥Âè∞Â§ß‰Ωú
            else if (lowerName.includes('ËâæÁàæÁôª') || lowerName.includes('elden ring') ||
                     lowerName.includes('ÈªëÁ•ûË©±') || lowerName.includes('wukong') ||
                     lowerName.includes('È≠îÁâ©Áçµ‰∫∫') || lowerName.includes('monster hunter') ||
                     lowerName.includes('ÊÉ°ÈùàÂè§Â†°') || lowerName.includes('resident evil')) {
                autoDetectPlatform('PC/PS5/PS4/Xbox');
            }
            else {
                clearDetectedPlatform();
            }
        }

        // Select question template
        function selectTemplate(templateKey) {
            const template = questionTemplates[templateKey];
            if (template) {
                document.getElementById('question').value = template;
                showToast('‚úÖ Â∑≤Â•óÁî®ÂïèÈ°åÊ®°Êùø');
            }
        }

        // Font size control
        function changeFontSize(delta) {
            fontSizeLevel = Math.max(0, Math.min(3, fontSizeLevel + delta));
            updateFontSize();
            saveSetting('guide_font_size', fontSizeLevel);
            showToast(`üìè Â≠óÈ´îÂ§ßÂ∞èÔºö${['Â∞è', '‰∏≠', 'Â§ß', 'ÁâπÂ§ß'][fontSizeLevel]}`);
        }

        function updateFontSize() {
            const resultCard = document.getElementById('resultCard');
            if (resultCard) {
                fontSizeClasses.forEach(cls => resultCard.classList.remove(cls));
                resultCard.classList.add(fontSizeClasses[fontSizeLevel]);
            }
        }

        // Platform Selection
        // Modal Functions
        function openModal() {
            document.getElementById('apiModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('apiModal').classList.remove('active');
        }

        async function saveApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (key) {
                apiKey = key;
                await saveSetting('gemini_api_key', key);
                closeModal();
                showToast('‚úÖ API Key Â∑≤ÂÑ≤Â≠ò');
            } else {
                showToast('‚ùå Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑ API Key', true);
            }
        }

        // Toast
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast' + (isError ? ' error' : '');
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Generate Guide
        async function generateGuide() {
            const gameName = document.getElementById('gameName').value.trim();
            const question = document.getElementById('question').value.trim();
            const btn = document.getElementById('generateBtn');

            // Validation
            if (!apiKey) {
                openModal();
                showToast('‚ùå Ë´ãÂÖàË®≠ÂÆö API Key', true);
                return;
            }

            if (!gameName) {
                showToast('‚ùå Ë´ãËº∏ÂÖ•ÈÅäÊà≤ÂêçÁ®±', true);
                return;
            }

            if (!question) {
                showToast('‚ùå Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÂïèÈ°å', true);
                return;
            }

            // Update UI
            btn.classList.add('loading');
            btn.textContent = 'ÁîüÊàê‰∏≠';
            btn.disabled = true;

            // ÂèñÂæóÂπ≥Âè∞È°ØÁ§∫ÂêçÁ®±Ôºà‰ΩøÁî®Ëá™ÂãïÂÅµÊ∏¨ÁöÑÂπ≥Âè∞ÊàñÈ°ØÁ§∫ÁÇ∫Â§öÂπ≥Âè∞Ôºâ
            let platformDisplayName;
            if (detectedPlatformRaw) {
                // Â¶ÇÊûúÊúâÂéüÂßãÂπ≥Âè∞Ë≥áÊñôÔºåÁõ¥Êé•‰ΩøÁî®
                platformDisplayName = detectedPlatformRaw;
            } else if (detectedPlatform && platformNames[detectedPlatform]) {
                platformDisplayName = platformNames[detectedPlatform];
            } else {
                // Ê≤íÊúâÂÅµÊ∏¨Âà∞Âπ≥Âè∞ÔºåËÆì AI Ëá™Ë°åÂà§Êñ∑
                platformDisplayName = 'ÂÖ®Âπ≥Âè∞/Áî±AIÊ†πÊìöÈÅäÊà≤Âà§Êñ∑';
            }

            // Prepare prompt - Âº∑Ë™øÂøÖÈ†àÊèê‰æõÁúüÂØ¶Ê∫ñÁ¢∫ÁöÑË≥áË®äËàáË©≥Á¥∞Ê≠•È©üÔºå‰∏¶‰ΩøÁî®Ë°®Ê†º
            const prompt = `‰Ω†ÊòØ‰∏Ä‰ΩçÂ∞àÊ•≠ÁöÑÈÅäÊà≤ÊîªÁï•Â∞àÂÆ∂„ÄÇË´ãÊ†πÊìöÁ∂≤Ë∑Ø‰∏äÂèØÈù†ÁöÑÈÅäÊà≤ÊîªÁï•Ë≥áÊ∫êÔºåÁÇ∫‰ª•‰∏ãÂïèÈ°åÊèê‰æõ**Ê∫ñÁ¢∫‰∏îÁ∂ìÈÅéÈ©óË≠â**ÁöÑÊîªÁï•ÊåáÂçó„ÄÇ

„ÄêÈáçË¶ÅË¶èÂâá„Äë
- Âè™Êèê‰æõ‰Ω†ËÉΩÂæûÂèØÈù†‰æÜÊ∫êÁ¢∫Ë™çÁöÑÁúüÂØ¶ÈÅäÊà≤Ë≥áË®ä
- Â¶ÇÊûúÊüê‰∫õË≥áË®äÁÑ°Ê≥ïÁ¢∫Ë™çÔºåË´ãÊòéÁ¢∫Ê®ôË®ª„ÄåÊ≠§Ë≥áË®äÈúÄË¶ÅÁé©ÂÆ∂Ëá™Ë°åÈ©óË≠â„Äç
- ‰∏çË¶ÅÁ∑®ÈÄ†‰∏çÂ≠òÂú®ÁöÑÈÅäÊà≤ÂÖßÂÆπ„ÄÅÈÅìÂÖ∑„ÄÅ‰ªªÂãôÊàñÊ©üÂà∂
- ÂÑ™ÂÖàÂèÉËÄÉÂÆòÊñπÊîªÁï•„ÄÅÁü•ÂêçÈÅäÊà≤Á∂≤Á´ôÔºàÂ¶ÇÂ∑¥ÂìàÂßÜÁâπ„ÄÅIGN„ÄÅGameFAQsÔºâÁöÑË≥áÊñô

„ÄêÊü•Ë©¢Ë≥áË®ä„Äë
Âπ≥Âè∞Ôºö${platformDisplayName}
ÈÅäÊà≤Ôºö${gameName}
ÂïèÈ°åÔºö${question}

„ÄêÂõûÁ≠îÊ†ºÂºèË¶ÅÊ±Ç - ÂøÖÈ†àÈÅµÂÆà„Äë

1. **ÂñÑÁî®Ë°®Ê†ºÂëàÁèæÊï∏Êìö**ÔºöÁï∂Ê∂âÂèä‰ª•‰∏ãÊÉÖÊ≥ÅÊôÇÔºåÂøÖÈ†à‰ΩøÁî® Markdown Ë°®Ê†ºÊ†ºÂºèÔºö
   - ÈÅìÂÖ∑/Ë£ùÂÇôÊØîËºÉÔºàÂêçÁ®±„ÄÅÊïàÊûú„ÄÅÂèñÂæóÊñπÂºèÔºâ
   - Boss/Êïµ‰∫∫Ë≥áÊñôÔºàHP„ÄÅÂº±Èªû„ÄÅÊéâËêΩÁâ©Ôºâ
   - ÊùêÊñôÊ∏ÖÂñÆÔºàÂêçÁ®±„ÄÅÊï∏Èáè„ÄÅ‰ΩçÁΩÆÔºâ
   - ÊäÄËÉΩ/Â±¨ÊÄßÊï∏ÂÄº
   - ‰ªªÂãôÁçéÂãµ
   
   Ë°®Ê†ºÁØÑ‰æãÔºö
   | ÈÅìÂÖ∑ÂêçÁ®± | ÊïàÊûú | ÂèñÂæó‰ΩçÁΩÆ |
   |---------|------|---------|
   | XXX | YYY | ZZZ |

2. **Ë©≥Á¥∞Ê≠•È©üË™™Êòé**ÔºöÂ¶ÇÊûúÂïèÈ°åÊ∂âÂèä‰ªª‰ΩïÊìç‰ΩúÊµÅÁ®ãÔºàÂ¶ÇÊâì Boss„ÄÅËß£Ë¨é„ÄÅÂÆåÊàê‰ªªÂãô„ÄÅÂèñÂæóÈÅìÂÖ∑Á≠âÔºâÔºåÂøÖÈ†àÊèê‰æõÁ∑®ËôüÁöÑÈÄêÊ≠•ÊåáÂçóÔºö
   1. [ÂÖ∑È´îÊìç‰Ωú]
   2. [ÂÖ∑È´îÊìç‰Ωú]
   3. ‰ª•Ê≠§È°ûÊé®...
   
3. **ÂâçÁΩÆÊ¢ù‰ª∂**Ôºö‰ΩøÁî®Ë°®Ê†ºË™™ÊòéÂü∑Ë°åÂâçÈúÄË¶ÅÊ∫ñÂÇô‰ªÄÈ∫º
   | È†ÖÁõÆ | Âª∫Ë≠∞ |
   |-----|-----|
   | Á≠âÁ¥ö | XX |
   | Ë£ùÂÇô | XX |
   | ÈÅìÂÖ∑ | XX |

4. **ÂÖ∑È´î‰ΩçÁΩÆ**ÔºöÂ¶ÇÊ∂âÂèäÂú∞ÈªûÔºåË´ãË™™ÊòéË©≥Á¥∞‰ΩçÁΩÆÔºàÂú∞ÂúñÂêçÁ®±„ÄÅÂ∫ßÊ®ô„ÄÅÂú∞Ê®ôÂèÉËÄÉÔºâ

5. **Êìç‰ΩúÊäÄÂ∑ß**Ôºö
   - ÊåâÈçµ/ÊâãÊääÊìç‰ΩúË™™Êòé
   - ÊôÇÊ©üÊääÊè°Ë¶ÅÈªû
   - Â∏∏Ë¶ãÂ§±ÊïóÂéüÂõ†ËàáËß£Ê±∫ÊñπÊ≥ï

6. **Ê≥®ÊÑè‰∫ãÈ†Ö**Ôºö
   - ÂèØËÉΩÈÅáÂà∞ÁöÑÈô∑Èò±ÊàñÊïµ‰∫∫
   - Êé®Ëñ¶ÁöÑÁ≠ñÁï•ÊàñÈÖçË£ù
   - Êõø‰ª£ÊñπÊ°àÔºàÂ¶ÇÊûúÊúâÁöÑË©±Ôºâ

Ë´ã‰ΩøÁî®ÁπÅÈ´î‰∏≠ÊñáÂõûÁ≠îÔºåÁ©çÊ•µ‰ΩøÁî® Markdown Ë°®Ê†º‰æÜÊï¥ÁêÜÊï∏ÊìöÔºå‰ΩøÁî® ## Ê®ôÈ°å„ÄÅÊï∏Â≠óÂàóË°®Ê≠•È©ü„ÄÅ**Á≤óÈ´î**ÈáçÈªûÔºåÁ¢∫‰øùÂÖßÂÆπÈáùÂ∞ç ${platformDisplayName} Âπ≥Âè∞ÁâàÊú¨„ÄÇ`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.3,
                            topK: 20,
                            topP: 0.8,
                            maxOutputTokens: 8192,
                        },
                        tools: [{
                            google_search: {}
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Ë´ãÊ±ÇÂ§±Êïó');
                }

                const data = await response.json();
                const content = data.candidates?.[0]?.content?.parts?.[0]?.text;
                
                // ÊèêÂèñ grounding ‰æÜÊ∫êË≥áË®ä
                const groundingMetadata = data.candidates?.[0]?.groundingMetadata;
                const searchSuggestions = groundingMetadata?.webSearchQueries || [];
                const groundingChunks = groundingMetadata?.groundingChunks || [];

                if (!content) {
                    throw new Error('Êú™ËÉΩÁîüÊàêÊîªÁï•ÂÖßÂÆπ');
                }

                // Save to conversation history
                currentGameName = gameName;
                currentPlatform = platformDisplayName;
                conversationHistory = [
                    { role: 'user', parts: [{ text: prompt }] },
                    { role: 'model', parts: [{ text: content }] }
                ];

                // Display result with sources
                displayResult(gameName, platformDisplayName, content, groundingChunks, question);
                showToast('‚úÖ ÊîªÁï•ÁîüÊàêÂÆåÊàêÔºÅÔºàÂ∑≤ÂèÉËÄÉÁ∂≤Ë∑ØË≥áÊñôÔºâ');

            } catch (error) {
                console.error('Error:', error);
                showToast(`‚ùå ${error.message}`, true);
            } finally {
                btn.classList.remove('loading');
                btn.textContent = '‚ö° ÁîüÊàêÊîªÁï•';
                btn.disabled = false;
            }
        }

        // Follow-up question
        async function askFollowup() {
            const followupInput = document.getElementById('followupInput');
            const followupBtn = document.getElementById('followupBtn');
            const followupQuestion = followupInput.value.trim();

            if (!followupQuestion) {
                showToast('‚ùå Ë´ãËº∏ÂÖ•ËøΩÂïèÂÖßÂÆπ', true);
                return;
            }

            if (conversationHistory.length === 0) {
                showToast('‚ùå Ë´ãÂÖàÁîüÊàêÊîªÁï•ÂÜçËøΩÂïè', true);
                return;
            }

            // Update UI
            followupBtn.disabled = true;
            followupBtn.textContent = '‚è≥ ÂõûÁ≠î‰∏≠...';

            const followupPrompt = `Áî®Êà∂ÈáùÂ∞çÂâõÊâçÁöÑ ${currentGameName} (${currentPlatform}) ÊîªÁï•ÊúâËøΩÂïèÔºö

${followupQuestion}

Ë´ãÊ†πÊìö‰πãÂâçÁöÑÊîªÁï•ÂÖßÂÆπÂíåÁ∂≤Ë∑Ø‰∏äÁöÑÂèØÈù†Ë≥áË®äÔºåÊèê‰æõÊ∫ñÁ¢∫ÁöÑË£úÂÖÖË™™Êòé„ÄÇ

Ê†ºÂºèË¶ÅÊ±ÇÔºö
- Â¶ÇÊûúÊ∂âÂèäÊï∏ÊìöÊØîËºÉÔºàÈÅìÂÖ∑„ÄÅË£ùÂÇô„ÄÅÊùêÊñô„ÄÅÊïµ‰∫∫Ë≥áÊñôÁ≠âÔºâÔºåË´ã‰ΩøÁî® Markdown Ë°®Ê†ºÊ†ºÂºè
- Â¶ÇÊûúÂïèÈ°åÊ∂âÂèäÊ≠•È©üÔºåË´ãÊèê‰æõË©≥Á¥∞ÁöÑÁ∑®ËôüÊ≠•È©ü
- ‰ΩøÁî® **Á≤óÈ´î** Ê®ôË®ªÈáçÈªû
- ‰ΩøÁî®ÁπÅÈ´î‰∏≠ÊñáÂíå Markdown Ê†ºÂºèÂõûÁ≠î`;

            try {
                // Build conversation with history
                const contents = [
                    ...conversationHistory,
                    { role: 'user', parts: [{ text: followupPrompt }] }
                ];

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: contents,
                        generationConfig: {
                            temperature: 0.3,
                            topK: 20,
                            topP: 0.8,
                            maxOutputTokens: 8192,
                        },
                        tools: [{
                            google_search: {}
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Ë´ãÊ±ÇÂ§±Êïó');
                }

                const data = await response.json();
                const content = data.candidates?.[0]?.content?.parts?.[0]?.text;
                const groundingChunks = data.candidates?.[0]?.groundingMetadata?.groundingChunks || [];

                if (!content) {
                    throw new Error('Êú™ËÉΩÁîüÊàêÂõûÁ≠î');
                }

                // Update conversation history
                conversationHistory.push(
                    { role: 'user', parts: [{ text: followupPrompt }] },
                    { role: 'model', parts: [{ text: content }] }
                );

                // Append to result
                appendFollowupResult(followupQuestion, content, groundingChunks);
                followupInput.value = '';
                showToast('‚úÖ ËøΩÂïèÂõûÁ≠îÂÆåÊàêÔºÅ');

            } catch (error) {
                console.error('Error:', error);
                showToast(`‚ùå ${error.message}`, true);
            } finally {
                followupBtn.disabled = false;
                followupBtn.textContent = 'üîÑ ËøΩÂïè';
            }
        }

        // Append follow-up result to content
        function appendFollowupResult(question, content, groundingChunks) {
            const resultContent = document.getElementById('resultContent');
            
            let html = `
                <div class="conversation-divider">ËøΩÂïèÂõûÁ≠î</div>
                <div class="question-badge">‚ùì ${escapeHtml(question)}</div>
            `;
            
            html += parseMarkdown(content);
            
            // Add sources if available
            if (groundingChunks.length > 0) {
                html += `<div class="sources-section">
                    <h3>üìö ÂèÉËÄÉ‰æÜÊ∫ê</h3>
                    <ul class="sources-list">`;
                
                const seenUrls = new Set();
                groundingChunks.forEach(chunk => {
                    if (chunk.web && chunk.web.uri && !seenUrls.has(chunk.web.uri)) {
                        seenUrls.add(chunk.web.uri);
                        const title = chunk.web.title || chunk.web.uri;
                        html += `<li><a href="${chunk.web.uri}" target="_blank" rel="noopener">${escapeHtml(title)}</a></li>`;
                    }
                });
                
                html += `</ul></div>`;
            }
            
            resultContent.innerHTML += html;
            
            // Scroll to new content
            resultContent.lastElementChild?.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Ëß£ÊûêMarkdownË°®Ê†º
        function parseMarkdownTables(text) {
            const lines = text.split('\n');
            let result = [];
            let tableLines = [];
            let inTable = false;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // Ê™¢Ê∏¨ÊòØÂê¶ÊòØË°®Ê†ºË°åÔºàÂåÖÂê´ | Á¨¶ËôüÔºâ
                if (line.startsWith('|') && line.endsWith('|')) {
                    inTable = true;
                    tableLines.push(line);
                } else if (inTable && line.match(/^\|[\s\-:|]+\|$/)) {
                    // ÂàÜÈöîÁ∑öË°å
                    tableLines.push(line);
                } else {
                    // Â¶ÇÊûú‰πãÂâçÂú®Ë°®Ê†º‰∏≠ÔºåÁèæÂú®ÁµêÊùü‰∫Ü
                    if (inTable && tableLines.length > 0) {
                        result.push(convertTableToHtml(tableLines));
                        tableLines = [];
                        inTable = false;
                    }
                    result.push(lines[i]);
                }
            }
            
            // ËôïÁêÜÊúÄÂæåÁöÑË°®Ê†º
            if (tableLines.length > 0) {
                result.push(convertTableToHtml(tableLines));
            }
            
            return result.join('\n');
        }

        // Â∞áË°®Ê†ºË°åËΩâÊèõÁÇ∫HTML
        function convertTableToHtml(tableLines) {
            if (tableLines.length < 2) return tableLines.join('\n');
            
            let html = '<table>';
            let isHeader = true;
            let headerProcessed = false;
            
            for (let i = 0; i < tableLines.length; i++) {
                const line = tableLines[i];
                
                // Ë∑≥ÈÅéÂàÜÈöîÁ∑öË°å
                if (line.match(/^\|[\s\-:|]+\|$/)) {
                    if (isHeader) {
                        html += '</thead><tbody>';
                        isHeader = false;
                        headerProcessed = true;
                    }
                    continue;
                }
                
                // Ëß£ÊûêÂñÆÂÖÉÊ†º
                const cells = line.split('|').slice(1, -1).map(cell => cell.trim());
                
                if (isHeader && !headerProcessed) {
                    html += '<thead><tr>';
                    cells.forEach(cell => {
                        // ÁÇ∫Ë°®È†≠Ê∑ªÂä†ÂúñÊ®ôË£ùÈ£æ
                        const icon = getTableHeaderIcon(cell);
                        html += `<th>${icon}${formatTableCell(cell)}</th>`;
                    });
                    html += '</tr>';
                } else {
                    html += '<tr>';
                    cells.forEach((cell, index) => {
                        html += `<td>${formatTableCell(cell)}</td>`;
                    });
                    html += '</tr>';
                }
            }
            
            if (!headerProcessed) {
                html += '</thead><tbody>';
            }
            
            html += '</tbody></table>';
            return html;
        }

        // Ê†ºÂºèÂåñË°®Ê†ºÂñÆÂÖÉÊ†ºÂÖßÂÆπ
        function formatTableCell(cell) {
            let formatted = cell;
            
            // ËôïÁêÜÁ≤óÈ´î
            formatted = formatted.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            
            // ËôïÁêÜÊï∏Â≠óÔºàÊ∑ªÂä†ÁâπÊÆäÊ®£ÂºèÔºâ
            formatted = formatted.replace(/^(\d+(?:\.\d+)?(?:[%ÂÄçËê¨ÂçÉ])?)$/g, '<span class="table-number">$1</span>');
            
            // ËôïÁêÜÁãÄÊÖãÊ®ôË®ò
            formatted = formatted.replace(/^(‚úì|‚úî|‚óã)$/g, '<span class="table-check">$1</span>');
            formatted = formatted.replace(/^(‚úó|‚úò|√ó)$/g, '<span class="table-cross">$1</span>');
            
            // ËôïÁêÜË©ïÁ¥öÊòüÊòü
            formatted = formatted.replace(/(‚òÖ+)/g, '<span class="table-stars">$1</span>');
            formatted = formatted.replace(/(‚òÜ+)/g, '<span class="table-stars-empty">$1</span>');
            
            return formatted;
        }

        // Ê†πÊìöË°®È†≠ÂÖßÂÆπÊ∑ªÂä†ÂúñÊ®ô
        function getTableHeaderIcon(headerText) {
            const iconMap = {
                'ÂêçÁ®±': 'üìõ ', 'ÂêçÂ≠ó': 'üìõ ', 'name': 'üìõ ',
                'ÈÅìÂÖ∑': 'üéí ', 'Áâ©ÂìÅ': 'üéí ', 'item': 'üéí ',
                '‰ΩçÁΩÆ': 'üìç ', 'Âú∞Èªû': 'üìç ', 'location': 'üìç ',
                'ÊïàÊûú': '‚ú® ', 'ËÉΩÂäõ': '‚ú® ', 'effect': '‚ú® ',
                'Êï∏Èáè': 'üî¢ ', 'Êï∏ÂÄº': 'üî¢ ', 'amount': 'üî¢ ',
                'Á≠âÁ¥ö': 'üìä ', 'level': 'üìä ', 'lv': 'üìä ',
                'ÊîªÊìä': '‚öîÔ∏è ', 'atk': '‚öîÔ∏è ', 'attack': '‚öîÔ∏è ',
                'Èò≤Á¶¶': 'üõ°Ô∏è ', 'def': 'üõ°Ô∏è ', 'defense': 'üõ°Ô∏è ',
                'HP': '‚ù§Ô∏è ', 'Ë°ÄÈáè': '‚ù§Ô∏è ', 'ÁîüÂëΩ': '‚ù§Ô∏è ',
                'MP': 'üíô ', 'È≠îÂäõ': 'üíô ', 'Ê≥ïÂäõ': 'üíô ',
                'ÂÉπÊ†º': 'üí∞ ', 'Ë≤ªÁî®': 'üí∞ ', 'price': 'üí∞ ',
                'Á®ÄÊúâÂ∫¶': 'üíé ', 'rarity': 'üíé ',
                'Â±¨ÊÄß': 'üîÆ ', 'type': 'üîÆ ', 'element': 'üîÆ ',
                'ÊäÄËÉΩ': '‚≠ê ', 'skill': '‚≠ê ',
                'ÊùêÊñô': 'üß± ', 'material': 'üß± ',
                'ÊéâËêΩ': 'üéÅ ', 'drop': 'üéÅ ',
                'Ë™™Êòé': 'üìù ', 'ÊèèËø∞': 'üìù ', 'description': 'üìù ',
                'Ê¢ù‰ª∂': 'üìã ', 'condition': 'üìã ',
                'ÊôÇÈñì': '‚è∞ ', 'time': '‚è∞ ',
                'Ê≠•È©ü': 'üìå ', 'step': 'üìå ',
                'Èõ£Â∫¶': 'üéØ ', 'difficulty': 'üéØ ',
                'ÁçéÂãµ': 'üèÜ ', 'reward': 'üèÜ ',
                'ÂÇôË®ª': 'üìé ', 'note': 'üìé ',
            };
            
            const lowerText = headerText.toLowerCase();
            for (const [key, icon] of Object.entries(iconMap)) {
                if (lowerText.includes(key.toLowerCase())) {
                    return icon;
                }
            }
            return '';
        }

        // Display Result with sources
        function displayResult(gameName, platform, content, groundingChunks = [], questionText = '') {
            const resultSection = document.getElementById('resultSection');
            const resultTitle = document.getElementById('resultTitle');
            const resultPlatform = document.getElementById('resultPlatform');
            const resultContent = document.getElementById('resultContent');
            const verifiedBadge = document.getElementById('verifiedBadge');

            resultTitle.textContent = `${gameName} ÊîªÁï•`;
            resultPlatform.textContent = platform;
            
            // È°ØÁ§∫È©óË≠âÊ®ôË®ò
            if (groundingChunks.length > 0) {
                verifiedBadge.style.display = 'inline-flex';
            } else {
                verifiedBadge.style.display = 'none';
            }
            
            // Parse markdown to HTML
            let html = parseMarkdown(content);
            
            // Ê∑ªÂä†ÂèÉËÄÉ‰æÜÊ∫êÂçÄÂ°ä
            if (groundingChunks.length > 0) {
                html += `<div class="sources-section">
                    <h3>üìö ÂèÉËÄÉ‰æÜÊ∫ê</h3>
                    <ul class="sources-list">`;
                
                const seenUrls = new Set();
                groundingChunks.forEach(chunk => {
                    if (chunk.web && chunk.web.uri && !seenUrls.has(chunk.web.uri)) {
                        seenUrls.add(chunk.web.uri);
                        const title = chunk.web.title || chunk.web.uri;
                        html += `<li><a href="${chunk.web.uri}" target="_blank" rel="noopener">${title}</a></li>`;
                    }
                });
                
                html += `</ul></div>`;
            }
            
            resultContent.innerHTML = html;
            
            resultSection.style.display = 'block';
            updateFontSize();
            
            // ÂÑ≤Â≠òÁï∂ÂâçÊîªÁï•Ë≥áÊñô‰æõÊî∂Ëóè‰ΩøÁî®
            currentGuideData = {
                question: questionText,
                content: html
            };
            
            // ÈáçÁΩÆÊî∂ËóèÊåâÈàïÁãÄÊÖã
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const isBookmarked = bookmarks.some(b => 
                b.gameName === currentGameName && b.question === questionText
            );
            if (isBookmarked) {
                bookmarkBtn.classList.add('bookmarked');
                bookmarkBtn.innerHTML = '‚≠ê Â∑≤Êî∂Ëóè';
            } else {
                bookmarkBtn.classList.remove('bookmarked');
                bookmarkBtn.innerHTML = '‚≠ê Êî∂Ëóè';
            }
            
            // Êõ¥Êñ∞ÈÅäÊà≤Ë≥áË®äÂç°
            const gameInfo = findGameInDatabase(gameName);
            if (gameInfo) {
                updateGameInfoCard(
                    gameInfo.name,
                    gameInfo.platform,
                    gameInfo.category,
                    gameInfo.icon
                );
            } else {
                updateGameInfoCard(
                    gameName,
                    platformDisplayName,
                    'ÈÅäÊà≤',
                    'üéÆ'
                );
            }
            
            // ÁîüÊàêÁõÆÈåÑ
            generateTOC();
            
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // Find game in database
        function findGameInDatabase(gameName) {
            const normalizedName = gameName.toLowerCase().trim();
            return gameDatabase.find(game => {
                if (game.name.toLowerCase() === normalizedName) return true;
                if (game.alias && game.alias.some(a => a.toLowerCase() === normalizedName)) return true;
                return false;
            });
        }

        // Enhanced Markdown Parser with Table Support
        function parseMarkdown(text) {
            // Escape HTML
            let html = text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');

            // Code blocks (ËôïÁêÜÂú®Ë°®Ê†º‰πãÂâç)
            html = html.replace(/```(\w*)\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>');
            
            // Inline code
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

            // Ëß£ÊûêMarkdownË°®Ê†º
            html = parseMarkdownTables(html);

            // Headers
            html = html.replace(/^### (.*$)/gm, '<h3>$1</h3>');
            html = html.replace(/^## (.*$)/gm, '<h2>$1</h2>');
            html = html.replace(/^# (.*$)/gm, '<h1>$1</h1>');

            // Bold and Italic
            html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');

            // Blockquotes
            html = html.replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>');

            // Unordered lists
            html = html.replace(/^\* (.*$)/gm, '<li>$1</li>');
            html = html.replace(/^- (.*$)/gm, '<li>$1</li>');
            html = html.replace(/^‚Ä¢ (.*$)/gm, '<li>$1</li>');

            // Ordered lists
            html = html.replace(/^\d+\. (.*$)/gm, '<li>$1</li>');

            // Wrap consecutive li elements in ul
            html = html.replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');

            // Line breaks
            html = html.replace(/\n\n/g, '</p><p>');
            html = html.replace(/\n/g, '<br>');

            // Wrap in paragraph
            html = '<p>' + html + '</p>';

            // Clean up
            html = html.replace(/<p><\/p>/g, '');
            
            // Ê∏ÖÁêÜË°®Ê†ºÂë®ÂúçÂ§öÈ§òÁöÑÊ®ôÁ±§
            html = html.replace(/<p>(<table[\s\S]*?<\/table>)<\/p>/g, '$1');
            html = html.replace(/<br>(<table)/g, '$1');
            html = html.replace(/(<\/table>)<br>/g, '$1');
            html = html.replace(/<p>(<h[1-3]>)/g, '$1');
            html = html.replace(/(<\/h[1-3]>)<\/p>/g, '$1');
            html = html.replace(/<p>(<ul>)/g, '$1');
            html = html.replace(/(<\/ul>)<\/p>/g, '$1');
            html = html.replace(/<p>(<pre>)/g, '$1');
            html = html.replace(/(<\/pre>)<\/p>/g, '$1');
            html = html.replace(/<p>(<blockquote>)/g, '$1');
            html = html.replace(/(<\/blockquote>)<\/p>/g, '$1');
            html = html.replace(/<br><\/p>/g, '</p>');
            html = html.replace(/<p><br>/g, '<p>');

            return html;
        }

        // Copy Result
        function copyResult() {
            const content = document.getElementById('resultContent').innerText;
            navigator.clipboard.writeText(content).then(() => {
                showToast('‚úÖ Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø');
            }).catch(() => {
                showToast('‚ùå Ë§áË£ΩÂ§±Êïó', true);
            });
        }

        // Close modal on outside click
        document.getElementById('apiModal').addEventListener('click', (e) => {
            if (e.target.id === 'apiModal') {
                closeModal();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
            if (e.key === 'Enter' && e.ctrlKey) {
                generateGuide();
            }
        });
    </script>
</body>
</html>
